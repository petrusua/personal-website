<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Rate Limit Your APIs With Apache APISIX | Navendu Pottekkat</title><meta name=keywords content="api gateway,apache apisix,tutorials"><meta name=description content="A guide to using the rate limit plugins in Apache APISIX with some practical examples."><meta name=author content="Navendu Pottekkat"><link rel=canonical href=https://navendu.me/posts/rate-limit/><script defer data-domain=navendu.me src=/misc/js/script.js data-api=/misc/api/event></script><script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script><script></script><link crossorigin=anonymous href=/assets/css/stylesheet.66e3e513d75c2ff303648a5691fa6787b3c8f1dc4b3307618713a4dc494f0696.css integrity="sha256-ZuPlE9dcL/MDZIpWkfpnh7PI8dxLMwdhhxOk3ElPBpY=" rel="preload stylesheet" as=style><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://navendu.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://navendu.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://navendu.me/favicon-32x32.png><link rel=apple-touch-icon href=https://navendu.me/apple-touch-icon.png><link rel=mask-icon href=https://navendu.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Rate Limit Your APIs With Apache APISIX"><meta property="og:description" content="A guide to using the rate limit plugins in Apache APISIX with some practical examples."><meta property="og:type" content="article"><meta property="og:url" content="https://navendu.me/posts/rate-limit/"><meta property="og:image" content="https://navendu.me/images/rate-limit/bucket-banner.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-14T11:18:53+05:30"><meta property="article:modified_time" content="2023-09-26T16:25:00+05:30"><meta property="og:site_name" content="Navendu Pottekkat"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://navendu.me/images/rate-limit/bucket-banner.jpg"><meta name=twitter:title content="Rate Limit Your APIs With Apache APISIX"><meta name=twitter:description content="A guide to using the rate limit plugins in Apache APISIX with some practical examples."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://navendu.me/posts/"},{"@type":"ListItem","position":2,"name":"Rate Limit Your APIs With Apache APISIX","item":"https://navendu.me/posts/rate-limit/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Rate Limit Your APIs With Apache APISIX","name":"Rate Limit Your APIs With Apache APISIX","description":"A guide to using the rate limit plugins in Apache APISIX with some practical examples.","keywords":["api gateway","apache apisix","tutorials"],"articleBody":"Setting up rate limits is a solid way to improve the reliability of your services.\nYou can ensure your services are not overloaded by setting up rate limits, providing consistent performance for the end users. It can also help enhance security by preventing denial-of-service (DoS) attacks which can take down your services.\nRate limiting can also be part of your business requirement where you want separate quotas for different tiers of users. For example, you can have a free version of your API where users can only make a small number of API calls and a paid version that allows ample API usage.\nIf you are using Apache APISIX as your API gateway, you can leverage the rate limiting plugins, limit-req, limit-conn, and limit-count to achieve this.\nYou can always set this up in your services directly without configuring it in APISIX. But as the number of your services increases, with each service having different constraints, setting up and managing different rate limits and updating them in each of these services becomes a pain point for development teams.\nIn this article, we will look at examples of how we can use the rate limiting plugins in APISIX. You can find the complete configuration files and instructions to deploy for this article in this repository.\nRate Limit All Requests Setting up a rate limit for all your requests is a good place to start.\nAPISIX allows configuring global rules that are applied on all requests to APISIX. We can configure a global rule with the limit-req plugin, as shown below:\ncurl localhost:9180/apisix/admin/global_rules/rate_limit_all -X PUT -d ' { \"plugins\": { \"limit-req\": { \"rate\": 30, \"burst\": 30, \"key_type\": \"var\", \"key\": \"remote_addr\", \"rejected_code\": 429, \"rejected_msg\": \"rate limit exceeded!\" } } }' The configuration above will allow 30 requests per second (rate) to your upstream services. When the number of requests exceeds 30 but is under 60 (burst), the additional requests are delayed to match the 30 requests per second limit. If the number of requests exceeds 60, the additional requests are rejected. In short, the upstream services will always have a maximum of 30 requests per second.\nA global rate limit can be helpful when you want to set hard limits on the number of requests your upstream should receive in a second. But sometimes, you might want to rate limit the requests to a particular route instead of all requests.\nTo do this, you can configure the plugin on a specific route. The example below shows how you can configure the limit-count plugin on a particular route:\ncurl localhost:9180/apisix/admin/routes/rate_limit_route -X PUT -d ' { \"uri\": \"/api\", \"upstream\": { \"type\": \"roundrobin\", \"nodes\": { \"upstream:80\": 1 } }, \"plugins\": { \"limit-count\": { \"count\": 10, \"time_window\": 60, \"key_type\": \"var\", \"key\": \"remote_addr\", \"policy\": \"local\", \"rejected_code\": 429, \"rejected_msg\": \"rate limit exceeded!\" } } }' This will allow only ten requests in a minute, and this will be reset every minute.\nA global and route level limit combo can be used to set hard limits on top of use case-specific limits, which is particularly helpful in many practical scenarios. For example, you can configure the limit-rate plugin in a global rule based on how much traffic your upstream services can handle and then configure limt-count plugins on specific routes to handle business specific rate limits.\nIf the same plugin is configured globally and at a route level, the lower of the two is used by APISIX.\nLimits for Consumers Rate limiting all requests is cool, but most of you readers might want to be more granular with your limits. A typical scenario is configuring different limits for different consumers of your API. And APISIX achieves this through the aptly-named consumer object.\nFor this example, we can create a consumer and use the basic key authentication provided by APISIX. We will then add the limit-conn plugin to this consumer. To create the consumer, send a request to the Admin API as shown:\ncurl localhost:9180/apisix/admin/consumers -X PUT -d ' { \"username\": \"alice\", \"plugins\": { \"key-auth\": { \"key\": \"beautifulalice\" }, \"limit-conn\": { \"conn\": 5, \"burst\": 3, \"default_conn_delay\": 0.1, \"key_type\": \"var\", \"key\": \"remote_addr\", \"rejected_code\": 429, \"rejected_msg\": \"too many concurrent requests!\" } } }' In the route, we will just enable the key-auth plugin:\ncurl localhost:9180/apisix/admin/routes/rate_limit_consumer -X PUT -d ' { \"uri\": \"/api\", \"upstream\": { \"type\": \"roundrobin\", \"nodes\": { \"upstream:80\": 1 } }, \"plugins\": { \"key-auth\": {} } }' We can create a different consumer and set up a different rate limit as well:\ncurl localhost:9180/apisix/admin/consumers -X PUT -d ' { \"username\": \"bob\", \"plugins\": { \"key-auth\": { \"key\": \"bobisawesome\" }, \"limit-conn\": { \"conn\": 2, \"burst\": 1, \"default_conn_delay\": 0.1, \"key_type\": \"var\", \"key\": \"remote_addr\", \"rejected_code\": 429, \"rejected_msg\": \"too many concurrent requests! please upgrade to increase this limit.\" } } }' Now APISIX will limit the number of concurrent requests these consumers can make independently as desired.\nGrouping Consumers Configuring each consumer individually can be a tedious process. In addition to supporting third-party authentication providers like Keycloak and Casdoor, APISIX has a consumer group object that lets you group individual consumers and apply configurations to the group.\nSo to apply rate limits to a group of consumers, we can create a consumer group object and add the limit-count plugin to it, as shown below:\ncurl localhost:9180/apisix/admin/consumer_groups/team_acme -X PUT -d ' { \"plugins\": { \"limit-count\": { \"count\": 10, \"time_window\": 60, \"key_type\": \"var\", \"key\": \"remote_addr\", \"policy\": \"local\", \"rejected_code\": 429, \"group\": \"team_acme\" } } }' We can also create a consumer group for consumers who are from another team on a different plan:\ncurl localhost:9180/apisix/admin/consumer_groups/team_rocket -X PUT -d ' { \"plugins\": { \"limit-count\": { \"count\": 100, \"time_window\": 60, \"key_type\": \"var\", \"key\": \"remote_addr\", \"policy\": \"local\", \"rejected_code\": 429, \"group\": \"team_rocket\" } } }' We can add consumers to these groups to attach the rate limit configuration:\ncurl localhost:9180/apisix/admin/consumers -X PUT -d ' { \"username\": \"eva\", \"plugins\": { \"key-auth\": { \"key\": \"everydayeva\" } }, \"group_id\": \"team_acme\" }' Now consumers in the team_acme group can only send ten requests per minute to your API, while consumers in the team_rocket group can send 100. So when alice from team_acme sends nine requests in a minute another user in the team, bob can only send one more request before the rate-limit quota is met.\nMulti-Node Rate Limits In many practical scenarios, you will have multiple instances of APISIX deployed for high availability. This could mean that a consumer of your API might be routed to different instances of APISIX for each request by the load balancer in front. In the context of rate limiting, what could go wrong here?\nWell, generally, APISIX tracks the rate limit in memory. And this could be problematic when using the limit-count plugin, where a consumer might be able to bypass the limit when there is a large enough number of APISIX nodes.\nA trivial solution here might be to set up sticky sessions in the load balancer so that each request gets sent to exactly a single node (on a side note, this article is excellent for learning how to set up sticky sessions with APISIX). But this could limit the scalability we are trying to achieve.\nA better way is to store the counter in a central location and have all APISIX nodes access it. So even if the load balancer routes to different nodes in each request, the same counter would be incremented each time. APISIX does this through Redis.\n Storing the counter in RedisNow instead of each APISIX node having its own counter, it uses a shared counter\n  The example below shows how you can configure this in a consumer group object:\ncurl localhost:9180/apisix/admin/consumer_groups/team_edward -X PUT -d ' { \"plugins\": { \"limit-count\": { \"count\": 10, \"time_window\": 60, \"key_type\": \"var\", \"key\": \"remote_addr\", \"policy\": \"redis\", \"redis_host\": \"redis\", \"redis_port\": 6379, \"redis_password\": \"password\", \"redis_database\": 1, \"redis_timeout\": 1001, \"rejected_code\": 429, \"group\": \"team_edward\" } } }' You can also use a Redis cluster instead of a single Redis service to make this more fault-tolerant:\ncurl localhost:9180/apisix/admin/consumer_groups/team_edward -X PUT -d ' { \"plugins\": { \"limit-count\": { \"count\": 10, \"time_window\": 60, \"key_type\": \"var\", \"key\": \"remote_addr\", \"policy\": \"redis-cluster\", \"redis_cluster_nodes\": [\"127.0.0.1:5000\", \"127.0.0.1:5001\"], \"redis_password\": \"password\", \"redis_cluster_name\": \"redis-cluster-1\", \"redis_timeout\": 1001, \"rejected_code\": 429, \"group\": \"team_edward\" } } }' That’s a lot for this article! In the upcoming article, we will examine how APISIX implements rate limiting under the hood and its implications. To learn more about the rate limit plugins, see the documentation at apisix.apache.org.\n","wordCount":"1385","inLanguage":"en","image":"https://navendu.me/images/rate-limit/bucket-banner.jpg","datePublished":"2023-08-14T11:18:53+05:30","dateModified":"2023-09-26T16:25:00+05:30","author":{"@type":"Person","name":"Navendu Pottekkat"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://navendu.me/posts/rate-limit/"},"publisher":{"@type":"Person","name":"Navendu Pottekkat","logo":{"@type":"ImageObject","url":"https://navendu.me/favicon.ico"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href=https://navendu.me/ accesskey=h title="Navendu Pottekkat (Alt + H)">Navendu Pottekkat</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://navendu.me/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://navendu.me/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://navendu.me/dailies/ title="Daily Logs"><span>Daily Logs</span></a></li><li><a href=https://navendu.me/about/ title=About><span>About</span></a></li><li><a href=https://navendu.me/subscribe/ title=Subscribe><span>Subscribe</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://navendu.me/>Home</a>&nbsp;»&nbsp;<a href=https://navendu.me/posts/>Posts</a></div><h1 class=post-title>Rate Limit Your APIs With Apache APISIX</h1><div class=post-meta><span title="2023-08-14 11:18:53 +0530 +0530">August 14, 2023</span>&nbsp;·&nbsp;7 min&nbsp;|&nbsp;<a href=https://github.com/pottekkat/personal-website/blob/hugo/content/posts/rate-limit.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=lazy src=https://navendu.me/images/rate-limit/bucket-banner.jpg alt="A drop of water falling into a bucket filled with water."></figure><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Rate Limit Your APIs With Apache APISIX on twitter" href="https://twitter.com/intent/tweet/?text=Rate%20Limit%20Your%20APIs%20With%20Apache%20APISIX&url=https%3a%2f%2fnavendu.me%2fposts%2frate-limit%2f&hashtags=apigateway%2capacheapisix%2ctutorials"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Rate Limit Your APIs With Apache APISIX on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fnavendu.me%2fposts%2frate-limit%2f&title=Rate%20Limit%20Your%20APIs%20With%20Apache%20APISIX&summary=Rate%20Limit%20Your%20APIs%20With%20Apache%20APISIX&source=https%3a%2f%2fnavendu.me%2fposts%2frate-limit%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Rate Limit Your APIs With Apache APISIX on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fnavendu.me%2fposts%2frate-limit%2f&title=Rate%20Limit%20Your%20APIs%20With%20Apache%20APISIX"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Rate Limit Your APIs With Apache APISIX on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fnavendu.me%2fposts%2frate-limit%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Rate Limit Your APIs With Apache APISIX on whatsapp" href="https://api.whatsapp.com/send?text=Rate%20Limit%20Your%20APIs%20With%20Apache%20APISIX%20-%20https%3a%2f%2fnavendu.me%2fposts%2frate-limit%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Rate Limit Your APIs With Apache APISIX on telegram" href="https://telegram.me/share/url?text=Rate%20Limit%20Your%20APIs%20With%20Apache%20APISIX&url=https%3a%2f%2fnavendu.me%2fposts%2frate-limit%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div><div class=post-content><p>Setting up rate limits is a solid way to improve the reliability of your services.</p><p>You can ensure your services are not overloaded by setting up rate limits, providing consistent performance for the end users. It can also help enhance security by preventing denial-of-service (DoS) attacks which can take down your services.</p><p>Rate limiting can also be part of your business requirement where you want separate quotas for different tiers of users. For example, you can have a free version of your API where users can only make a small number of API calls and a paid version that allows ample API usage.</p><p>If you are using <a href="https://apisix.apache.org?utm_source=navendu_blog&utm_medium=referral&utm_campaign=rate-limit-your-apis-with-apache-apisix" target=_blank>Apache APISIX</a> as your API gateway, you can leverage the rate limiting plugins, <a href="https://apisix.apache.org/docs/apisix/plugins/limit-req/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=rate-limit-your-apis-with-apache-apisix" target=_blank>limit-req</a>, <a href="https://apisix.apache.org/docs/apisix/plugins/limit-conn/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=rate-limit-your-apis-with-apache-apisix" target=_blank>limit-conn</a>, and <a href="https://apisix.apache.org/docs/apisix/plugins/limit-count/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=rate-limit-your-apis-with-apache-apisix" target=_blank>limit-count</a> to achieve this.</p><p>You can always set this up in your services directly without configuring it in APISIX. But as the number of your services increases, with each service having different constraints, setting up and managing different rate limits and updating them in each of these services becomes a pain point for development teams.</p><p>In this article, we will look at examples of how we can use the rate limiting plugins in APISIX. You can find the complete configuration files and instructions to deploy for this article in <a href="https://github.com/pottekkat/rate-limit?utm_source=navendu_blog&utm_medium=referral&utm_campaign=rate-limit-your-apis-with-apache-apisix" target=_blank>this repository</a>.</p><h2 id=rate-limit-all-requests>Rate Limit All Requests<a hidden class=anchor aria-hidden=true href=#rate-limit-all-requests>#</a></h2><p>Setting up a rate limit for all your requests is a good place to start.</p><p>APISIX allows configuring <a href="https://apisix.apache.org/docs/apisix/terminology/global-rule/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=rate-limit-your-apis-with-apache-apisix" target=_blank>global rules</a> that are applied on all requests to APISIX. We can configure a global rule with the <code>limit-req</code> plugin, as shown below:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>curl localhost:9180/apisix/admin/global_rules/rate_limit_all -X PUT -d <span style=color:#e6db74>&#39;
</span><span style=color:#e6db74>{
</span><span style=color:#e6db74>  &#34;plugins&#34;: {
</span><span style=color:#e6db74>    &#34;limit-req&#34;: {
</span><span style=color:#e6db74>      &#34;rate&#34;: 30,
</span><span style=color:#e6db74>      &#34;burst&#34;: 30,
</span><span style=color:#e6db74>      &#34;key_type&#34;: &#34;var&#34;,
</span><span style=color:#e6db74>      &#34;key&#34;: &#34;remote_addr&#34;,
</span><span style=color:#e6db74>      &#34;rejected_code&#34;: 429,
</span><span style=color:#e6db74>      &#34;rejected_msg&#34;: &#34;rate limit exceeded!&#34;
</span><span style=color:#e6db74>    }
</span><span style=color:#e6db74>  }
</span><span style=color:#e6db74>}&#39;</span>
</code></pre></div><p>The configuration above will allow 30 requests per second (rate) to your upstream services. When the number of requests exceeds 30 but is under 60 (burst), the additional requests are delayed to match the 30 requests per second limit. If the number of requests exceeds 60, the additional requests are rejected. In short, the upstream services will always have a maximum of 30 requests per second.</p><p>A global rate limit can be helpful when you want to set hard limits on the number of requests your upstream should receive in a second. But sometimes, you might want to rate limit the requests to a particular route instead of all requests.</p><p>To do this, you can configure the plugin on a specific route. The example below shows how you can configure the <code>limit-count</code> plugin on a particular route:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>curl localhost:9180/apisix/admin/routes/rate_limit_route -X PUT -d <span style=color:#e6db74>&#39;
</span><span style=color:#e6db74>{
</span><span style=color:#e6db74>  &#34;uri&#34;: &#34;/api&#34;,
</span><span style=color:#e6db74>  &#34;upstream&#34;: {
</span><span style=color:#e6db74>    &#34;type&#34;: &#34;roundrobin&#34;,
</span><span style=color:#e6db74>    &#34;nodes&#34;: {
</span><span style=color:#e6db74>      &#34;upstream:80&#34;: 1
</span><span style=color:#e6db74>    }
</span><span style=color:#e6db74>  },
</span><span style=color:#e6db74>  &#34;plugins&#34;: {
</span><span style=color:#e6db74>    &#34;limit-count&#34;: {
</span><span style=color:#e6db74>      &#34;count&#34;: 10,
</span><span style=color:#e6db74>      &#34;time_window&#34;: 60,
</span><span style=color:#e6db74>      &#34;key_type&#34;: &#34;var&#34;,
</span><span style=color:#e6db74>      &#34;key&#34;: &#34;remote_addr&#34;,
</span><span style=color:#e6db74>      &#34;policy&#34;: &#34;local&#34;,
</span><span style=color:#e6db74>      &#34;rejected_code&#34;: 429,
</span><span style=color:#e6db74>      &#34;rejected_msg&#34;: &#34;rate limit exceeded!&#34;
</span><span style=color:#e6db74>    }
</span><span style=color:#e6db74>  }
</span><span style=color:#e6db74>}&#39;</span>
</code></pre></div><p>This will allow only ten requests in a minute, and this will be reset every minute.</p><p>A global and route level limit combo can be used to set hard limits on top of use case-specific limits, which is particularly helpful in many practical scenarios. For example, you can configure the <code>limit-rate</code> plugin in a global rule based on how much traffic your upstream services can handle and then configure <code>limt-count</code> plugins on specific routes to handle business specific rate limits.</p><p>If the same plugin is configured globally and at a route level, the lower of the two is used by APISIX.</p><h2 id=limits-for-consumers>Limits for Consumers<a hidden class=anchor aria-hidden=true href=#limits-for-consumers>#</a></h2><p>Rate limiting all requests is cool, but most of you readers might want to be more granular with your limits. A typical scenario is configuring different limits for different consumers of your API. And APISIX achieves this through the aptly-named <a href="https://apisix.apache.org/docs/apisix/terminology/consumer/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=rate-limit-your-apis-with-apache-apisix" target=_blank>consumer</a> object.</p><p>For this example, we can create a consumer and use the <a href="https://apisix.apache.org/docs/apisix/plugins/key-auth/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=rate-limit-your-apis-with-apache-apisix" target=_blank>basic key authentication</a> provided by APISIX. We will then add the <code>limit-conn</code> plugin to this consumer. To create the consumer, send a request to the Admin API as shown:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>curl localhost:9180/apisix/admin/consumers -X PUT -d <span style=color:#e6db74>&#39;
</span><span style=color:#e6db74>{
</span><span style=color:#e6db74>  &#34;username&#34;: &#34;alice&#34;,
</span><span style=color:#e6db74>  &#34;plugins&#34;: {
</span><span style=color:#e6db74>    &#34;key-auth&#34;: {
</span><span style=color:#e6db74>      &#34;key&#34;: &#34;beautifulalice&#34;
</span><span style=color:#e6db74>    },
</span><span style=color:#e6db74>    &#34;limit-conn&#34;: {
</span><span style=color:#e6db74>      &#34;conn&#34;: 5,
</span><span style=color:#e6db74>      &#34;burst&#34;: 3,
</span><span style=color:#e6db74>      &#34;default_conn_delay&#34;: 0.1,
</span><span style=color:#e6db74>      &#34;key_type&#34;: &#34;var&#34;,
</span><span style=color:#e6db74>      &#34;key&#34;: &#34;remote_addr&#34;,
</span><span style=color:#e6db74>      &#34;rejected_code&#34;: 429,
</span><span style=color:#e6db74>      &#34;rejected_msg&#34;: &#34;too many concurrent requests!&#34;
</span><span style=color:#e6db74>    }
</span><span style=color:#e6db74>  }
</span><span style=color:#e6db74>}&#39;</span>
</code></pre></div><p>In the route, we will just enable the <code>key-auth</code> plugin:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>curl localhost:9180/apisix/admin/routes/rate_limit_consumer -X PUT -d <span style=color:#e6db74>&#39;
</span><span style=color:#e6db74>{
</span><span style=color:#e6db74>  &#34;uri&#34;: &#34;/api&#34;,
</span><span style=color:#e6db74>  &#34;upstream&#34;: {
</span><span style=color:#e6db74>    &#34;type&#34;: &#34;roundrobin&#34;,
</span><span style=color:#e6db74>    &#34;nodes&#34;: {
</span><span style=color:#e6db74>      &#34;upstream:80&#34;: 1
</span><span style=color:#e6db74>    }
</span><span style=color:#e6db74>  },
</span><span style=color:#e6db74>  &#34;plugins&#34;: {
</span><span style=color:#e6db74>    &#34;key-auth&#34;: {}
</span><span style=color:#e6db74>  }
</span><span style=color:#e6db74>}&#39;</span>
</code></pre></div><p>We can create a different consumer and set up a different rate limit as well:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>curl localhost:9180/apisix/admin/consumers -X PUT -d <span style=color:#e6db74>&#39;
</span><span style=color:#e6db74>{
</span><span style=color:#e6db74>  &#34;username&#34;: &#34;bob&#34;,
</span><span style=color:#e6db74>  &#34;plugins&#34;: {
</span><span style=color:#e6db74>    &#34;key-auth&#34;: {
</span><span style=color:#e6db74>      &#34;key&#34;: &#34;bobisawesome&#34;
</span><span style=color:#e6db74>    },
</span><span style=color:#e6db74>    &#34;limit-conn&#34;: {
</span><span style=color:#e6db74>      &#34;conn&#34;: 2,
</span><span style=color:#e6db74>      &#34;burst&#34;: 1,
</span><span style=color:#e6db74>      &#34;default_conn_delay&#34;: 0.1,
</span><span style=color:#e6db74>      &#34;key_type&#34;: &#34;var&#34;,
</span><span style=color:#e6db74>      &#34;key&#34;: &#34;remote_addr&#34;,
</span><span style=color:#e6db74>      &#34;rejected_code&#34;: 429,
</span><span style=color:#e6db74>      &#34;rejected_msg&#34;: &#34;too many concurrent requests! please upgrade to increase this limit.&#34;
</span><span style=color:#e6db74>    }
</span><span style=color:#e6db74>  }
</span><span style=color:#e6db74>}&#39;</span>
</code></pre></div><p>Now APISIX will limit the number of concurrent requests these consumers can make independently as desired.</p><h2 id=grouping-consumers>Grouping Consumers<a hidden class=anchor aria-hidden=true href=#grouping-consumers>#</a></h2><p>Configuring each consumer individually can be a tedious process. In addition to supporting third-party authentication providers like <a href="https://apisix.apache.org/docs/apisix/plugins/authz-keycloak/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=rate-limit-your-apis-with-apache-apisix" target=_blank>Keycloak</a> and <a href="https://apisix.apache.org/docs/apisix/plugins/authz-casdoor/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=rate-limit-your-apis-with-apache-apisix" target=_blank>Casdoor</a>, APISIX has a consumer group object that lets you group individual consumers and apply configurations to the group.</p><p>So to apply rate limits to a group of consumers, we can create a consumer group object and add the <code>limit-count</code> plugin to it, as shown below:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>curl localhost:9180/apisix/admin/consumer_groups/team_acme -X PUT -d <span style=color:#e6db74>&#39;
</span><span style=color:#e6db74>{
</span><span style=color:#e6db74>  &#34;plugins&#34;: {
</span><span style=color:#e6db74>    &#34;limit-count&#34;: {
</span><span style=color:#e6db74>      &#34;count&#34;: 10,
</span><span style=color:#e6db74>      &#34;time_window&#34;: 60,
</span><span style=color:#e6db74>      &#34;key_type&#34;: &#34;var&#34;,
</span><span style=color:#e6db74>      &#34;key&#34;: &#34;remote_addr&#34;,
</span><span style=color:#e6db74>      &#34;policy&#34;: &#34;local&#34;,
</span><span style=color:#e6db74>      &#34;rejected_code&#34;: 429,
</span><span style=color:#e6db74>      &#34;group&#34;: &#34;team_acme&#34;
</span><span style=color:#e6db74>    }
</span><span style=color:#e6db74>  }
</span><span style=color:#e6db74>}&#39;</span>
</code></pre></div><p>We can also create a consumer group for consumers who are from another team on a different plan:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>curl localhost:9180/apisix/admin/consumer_groups/team_rocket -X PUT -d <span style=color:#e6db74>&#39;
</span><span style=color:#e6db74>{
</span><span style=color:#e6db74>  &#34;plugins&#34;: {
</span><span style=color:#e6db74>    &#34;limit-count&#34;: {
</span><span style=color:#e6db74>      &#34;count&#34;: 100,
</span><span style=color:#e6db74>      &#34;time_window&#34;: 60,
</span><span style=color:#e6db74>      &#34;key_type&#34;: &#34;var&#34;,
</span><span style=color:#e6db74>      &#34;key&#34;: &#34;remote_addr&#34;,
</span><span style=color:#e6db74>      &#34;policy&#34;: &#34;local&#34;,
</span><span style=color:#e6db74>      &#34;rejected_code&#34;: 429,
</span><span style=color:#e6db74>      &#34;group&#34;: &#34;team_rocket&#34;
</span><span style=color:#e6db74>    }
</span><span style=color:#e6db74>  }
</span><span style=color:#e6db74>}&#39;</span>
</code></pre></div><p>We can add consumers to these groups to attach the rate limit configuration:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>curl localhost:9180/apisix/admin/consumers -X PUT -d <span style=color:#e6db74>&#39;
</span><span style=color:#e6db74>{
</span><span style=color:#e6db74>  &#34;username&#34;: &#34;eva&#34;,
</span><span style=color:#e6db74>  &#34;plugins&#34;: {
</span><span style=color:#e6db74>    &#34;key-auth&#34;: {
</span><span style=color:#e6db74>      &#34;key&#34;: &#34;everydayeva&#34;
</span><span style=color:#e6db74>    }
</span><span style=color:#e6db74>  },
</span><span style=color:#e6db74>  &#34;group_id&#34;: &#34;team_acme&#34;
</span><span style=color:#e6db74>}&#39;</span>
</code></pre></div><p>Now consumers in the <code>team_acme</code> group can only send ten requests per minute to your API, while consumers in the <code>team_rocket</code> group can send 100. So when <code>alice</code> from <code>team_acme</code> sends nine requests in a minute another user in the team, <code>bob</code> can only send one more request before the rate-limit quota is met.</p><h2 id=multi-node-rate-limits>Multi-Node Rate Limits<a hidden class=anchor aria-hidden=true href=#multi-node-rate-limits>#</a></h2><p>In many practical scenarios, you will have multiple instances of APISIX deployed for high availability. This could mean that a consumer of your API might be routed to different instances of APISIX for each request by the load balancer in front. In the context of rate limiting, what could go wrong here?</p><p>Well, generally, APISIX tracks the rate limit in memory. And this could be problematic when using the <code>limit-count</code> plugin, where a consumer might be able to bypass the limit when there is a large enough number of APISIX nodes.</p><p>A trivial solution here might be to set up sticky sessions in the load balancer so that each request gets sent to exactly a single node (on a side note, <a href="https://blog.frankel.ch/sticky-sessions-apache-apisix/1/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=rate-limit-your-apis-with-apache-apisix" target=_blank>this article</a> is excellent for learning how to set up sticky sessions with APISIX). But this could limit the scalability we are trying to achieve.</p><p>A better way is to store the counter in a central location and have all APISIX nodes access it. So even if the load balancer routes to different nodes in each request, the same counter would be incremented each time. APISIX does this through <a href="https://redis.io/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=rate-limit-your-apis-with-apache-apisix" target=_blank>Redis</a>.</p><figure class=align-center><a href=/images/rate-limit/redis-counter.png target=_blank><img loading=lazy src=/images/rate-limit/redis-counter.png#center alt="Storing the counter in Redis"></a><figcaption>Storing the counter in Redis<p>Now instead of each APISIX node having its own counter, it uses a shared counter</p></figcaption></figure><p>The example below shows how you can configure this in a consumer group object:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>curl localhost:9180/apisix/admin/consumer_groups/team_edward -X PUT -d <span style=color:#e6db74>&#39;
</span><span style=color:#e6db74>{
</span><span style=color:#e6db74>  &#34;plugins&#34;: {
</span><span style=color:#e6db74>    &#34;limit-count&#34;: {
</span><span style=color:#e6db74>      &#34;count&#34;: 10,
</span><span style=color:#e6db74>      &#34;time_window&#34;: 60,
</span><span style=color:#e6db74>      &#34;key_type&#34;: &#34;var&#34;,
</span><span style=color:#e6db74>      &#34;key&#34;: &#34;remote_addr&#34;,
</span><span style=color:#e6db74>      &#34;policy&#34;: &#34;redis&#34;,
</span><span style=color:#e6db74>      &#34;redis_host&#34;: &#34;redis&#34;,
</span><span style=color:#e6db74>      &#34;redis_port&#34;: 6379,
</span><span style=color:#e6db74>      &#34;redis_password&#34;: &#34;password&#34;,
</span><span style=color:#e6db74>      &#34;redis_database&#34;: 1,
</span><span style=color:#e6db74>      &#34;redis_timeout&#34;: 1001,
</span><span style=color:#e6db74>      &#34;rejected_code&#34;: 429,
</span><span style=color:#e6db74>      &#34;group&#34;: &#34;team_edward&#34;
</span><span style=color:#e6db74>    }
</span><span style=color:#e6db74>  }
</span><span style=color:#e6db74>}&#39;</span>
</code></pre></div><p>You can also use a Redis cluster instead of a single Redis service to make this more fault-tolerant:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>curl localhost:9180/apisix/admin/consumer_groups/team_edward -X PUT -d <span style=color:#e6db74>&#39;
</span><span style=color:#e6db74>{
</span><span style=color:#e6db74>  &#34;plugins&#34;: {
</span><span style=color:#e6db74>    &#34;limit-count&#34;: {
</span><span style=color:#e6db74>      &#34;count&#34;: 10,
</span><span style=color:#e6db74>      &#34;time_window&#34;: 60,
</span><span style=color:#e6db74>      &#34;key_type&#34;: &#34;var&#34;,
</span><span style=color:#e6db74>      &#34;key&#34;: &#34;remote_addr&#34;,
</span><span style=color:#e6db74>      &#34;policy&#34;: &#34;redis-cluster&#34;,
</span><span style=color:#e6db74>      &#34;redis_cluster_nodes&#34;: [&#34;127.0.0.1:5000&#34;, &#34;127.0.0.1:5001&#34;],
</span><span style=color:#e6db74>      &#34;redis_password&#34;: &#34;password&#34;,
</span><span style=color:#e6db74>      &#34;redis_cluster_name&#34;: &#34;redis-cluster-1&#34;,
</span><span style=color:#e6db74>      &#34;redis_timeout&#34;: 1001,
</span><span style=color:#e6db74>      &#34;rejected_code&#34;: 429,
</span><span style=color:#e6db74>      &#34;group&#34;: &#34;team_edward&#34;
</span><span style=color:#e6db74>    }
</span><span style=color:#e6db74>  }
</span><span style=color:#e6db74>}&#39;</span>
</code></pre></div><p>That&rsquo;s a lot for this article! In the upcoming article, we will examine how APISIX implements rate limiting under the hood and its implications. To learn more about the rate limit plugins, see the documentation at <a href="https://apisix.apache.org/docs/apisix/next/plugins/limit-req/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=rate-limit-your-apis-with-apache-apisix" target=_blank>apisix.apache.org</a>.</p><h2>Related Posts</h2><ul><li><a href=/posts/tinier-apisix-plugin/>A "Tinier" APISIX Plugin</a></li><li><a href=/posts/managing-apisix-declaratively/>Managing APISIX Declaratively with ADC</a></li><li><a href=/posts/request-validation/>Your API Requests Should Be Validated</a></li></ul><section class=subscribe-content><hr><p>Thank you for reading <i>"Rate Limit Your APIs With Apache APISIX."</i></p><p>Subscribe via <a href=/subscribe>email</a> or
<a href=/index.xml target=_blank>RSS feed</a> to be the first to receive
my content.</p><p>If you liked this post, check out my <a href=/categories/featured>featured posts</a> or learn more <a href=/about>about me</a>.</p></section><section class=subscription-form><form action="https://navendu.us5.list-manage.com/subscribe/post-json?u=fb9ffeb3ee6bc8aaf1d5b8a98&id=5ff8367bc1&c=?" method=post autocomplete=off class=subscribe-form><div class=subscribe-input><input type=email name=EMAIL id=email required placeholder="Email Address ↵" title="Email Address"></div><input value=Subscribe type=submit class=subscribe-button title=Subscribe></form><section class=entry-content><div class=subscribe-message>Get a biweekly dose of tech news, curated content, and uninterrupted musings.</div></section></section><script>$(".subscribe-form").submit(function(d){var a,b,c;d.preventDefault(),a=$(this),b=a.attr("action"),c=a.attr("method"),$.ajax({type:c,url:b,data:a.serialize(),dataType:`jsonp`,success:function(b){b.result===`success`?(a.find(".subscribe-button").attr("value","Subscribed!"),$(".subscribe-message").html("Thank you for subscribing! Check your inbox and add me in your contacts to not miss an issue! <a target='_blank' href='https://twitter.com/intent/tweet?url=https%3A%2F%2Fnavendu.me&text=I%20just%20subscribed%20to%20@sudo_navendu%27s%20blog%21%20Check%20it%20out%21&hashtags=OpenSource%2CDevelopers%2CDEVCommunity'>Tweet about it</a>!"),$(".subscribe-form :input").prop("disabled",!0)):(a.find(".subscribe-button").attr("value","Failed to Subscribe! Click again to retry"),$(".subscribe-message").html("There was an error subscribing you to my blog. "+b.msg+"."),a[0].reset()),console.log(b)},error:function(b){console.log("An error occurred."),console.log(b),a[0].reset()}})})</script></div><footer class=post-footer><ul class=post-tags><li><a href=https://navendu.me/tags/api-gateway/>api gateway</a></li><li><a href=https://navendu.me/tags/apache-apisix/>apache apisix</a></li><li><a href=https://navendu.me/tags/tutorials/>tutorials</a></li></ul><nav class=paginav><a class=prev href=https://navendu.me/posts/list-series-hugo/><span class=title>« Prev</span><br><span>List Articles from a Series in Hugo</span></a>
<a class=next href=https://navendu.me/posts/request-validation/><span class=title>Next »</span><br><span>Your API Requests Should Be Validated</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Rate Limit Your APIs With Apache APISIX on twitter" href="https://twitter.com/intent/tweet/?text=Rate%20Limit%20Your%20APIs%20With%20Apache%20APISIX&url=https%3a%2f%2fnavendu.me%2fposts%2frate-limit%2f&hashtags=apigateway%2capacheapisix%2ctutorials"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Rate Limit Your APIs With Apache APISIX on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fnavendu.me%2fposts%2frate-limit%2f&title=Rate%20Limit%20Your%20APIs%20With%20Apache%20APISIX&summary=Rate%20Limit%20Your%20APIs%20With%20Apache%20APISIX&source=https%3a%2f%2fnavendu.me%2fposts%2frate-limit%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Rate Limit Your APIs With Apache APISIX on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fnavendu.me%2fposts%2frate-limit%2f&title=Rate%20Limit%20Your%20APIs%20With%20Apache%20APISIX"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Rate Limit Your APIs With Apache APISIX on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fnavendu.me%2fposts%2frate-limit%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Rate Limit Your APIs With Apache APISIX on whatsapp" href="https://api.whatsapp.com/send?text=Rate%20Limit%20Your%20APIs%20With%20Apache%20APISIX%20-%20https%3a%2f%2fnavendu.me%2fposts%2frate-limit%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Rate Limit Your APIs With Apache APISIX on telegram" href="https://telegram.me/share/url?text=Rate%20Limit%20Your%20APIs%20With%20Apache%20APISIX&url=https%3a%2f%2fnavendu.me%2fposts%2frate-limit%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>This work by <a href=https://navendu.me/about/#about-me>Navendu Pottekkat</a></span>
<span>is licensed under <a rel=license href=http://creativecommons.org/licenses/by-sa/4.0 target=_blank>CC BY-SA 4.0</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerHTML='copy';function d(){a.innerHTML='copied!',setTimeout(()=>{a.innerHTML='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script><script>for(var els=document.getElementsByClassName("highlight"),i=0,title,code,newNode;i<els.length;i++)title=els[i].title,code=els[i].firstElementChild.firstElementChild,title.length&&(newNode=document.createElement("div"),newNode.textContent=title,newNode.classList.add("highlight-title"),code.parentNode.insertBefore(newNode,code))</script></body></html>