<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Combing through APISIX Logs with the Elastic (ELK) Stack | Navendu Pottekkat</title><meta name=keywords content="apache apisix,tutorials,elasticsearch,monitoring"><meta name=description content="A guide on using Elasticsearch, Kibana, and Logstash to work with logs from Apache APISIX."><meta name=author content="Navendu Pottekkat"><link rel=canonical href=https://navendu.me/posts/apisix-logs-elk/><script defer data-domain=navendu.me src=/misc/js/script.js data-api=/misc/api/event></script><script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script><script></script><link crossorigin=anonymous href=/assets/css/stylesheet.66e3e513d75c2ff303648a5691fa6787b3c8f1dc4b3307618713a4dc494f0696.css integrity="sha256-ZuPlE9dcL/MDZIpWkfpnh7PI8dxLMwdhhxOk3ElPBpY=" rel="preload stylesheet" as=style><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://navendu.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://navendu.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://navendu.me/favicon-32x32.png><link rel=apple-touch-icon href=https://navendu.me/apple-touch-icon.png><link rel=mask-icon href=https://navendu.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Combing through APISIX Logs with the Elastic (ELK) Stack"><meta property="og:description" content="A guide on using Elasticsearch, Kibana, and Logstash to work with logs from Apache APISIX."><meta property="og:type" content="article"><meta property="og:url" content="https://navendu.me/posts/apisix-logs-elk/"><meta property="og:image" content="https://navendu.me/images/apisix-logs-elk/elk-banner.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-28T09:05:46+05:30"><meta property="article:modified_time" content="2023-09-26T16:25:00+05:30"><meta property="og:site_name" content="Navendu Pottekkat"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://navendu.me/images/apisix-logs-elk/elk-banner.jpg"><meta name=twitter:title content="Combing through APISIX Logs with the Elastic (ELK) Stack"><meta name=twitter:description content="A guide on using Elasticsearch, Kibana, and Logstash to work with logs from Apache APISIX."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://navendu.me/posts/"},{"@type":"ListItem","position":2,"name":"Combing through APISIX Logs with the Elastic (ELK) Stack","item":"https://navendu.me/posts/apisix-logs-elk/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Combing through APISIX Logs with the Elastic (ELK) Stack","name":"Combing through APISIX Logs with the Elastic (ELK) Stack","description":"A guide on using Elasticsearch, Kibana, and Logstash to work with logs from Apache APISIX.","keywords":["apache apisix","tutorials","elasticsearch","monitoring"],"articleBody":"In most applications, Apache APISIX, the API gateway, sits in front of the backend services and acts as a single entry point. This allows application developers to use APISIX logs to provide insights into how their system and APISIX perform in real time.\nDevelopers can also gather data from the logs and use it to improve the reliability and security of their applications. For example, data on the latency of different services can be used to identify issues and bottlenecks in your applications.\nAdditionally, these logs could also help handle some business-specific scenarios at the API gateway level, like user behavior analysis. However, it might not be as robust as event-driven trackers.\nBut gathering these logs and making them useful can be a difficult task. Even though I am a big fan of going through large log files using basic search tools, it often lacks trivial ways to search, filter, visualize, and gather insights needed to manage complex applications.\nThe Elastic (ELK) stack is a widely used observability stack for such applications. It primarily consists of three tools:\n Elasticsearch: A JSON-based datastore that stores and indexes data. In the ELK stack, it is used to store and search through large amounts of logs in real time. Logstash: A preprocessor for Elasticsearch that takes data from different sources, transforms it, and stores it in an external service (usually Elasticsearch in the ELK stack). Kibana: A web-based dashboard that lets you access, visualize, analyze (and more) the data built and indexed by Elasticsearch.  These tools can be used independently outside this particular stack but are tailored to work together.\nApache APISIX supports both these use cases out of the box through built-in plugins. This article will examine how you can configure these plugins in APISIX to work with the ELK stack. We will also look at how this system scales as applications get bigger.\nThe complete configuration used in this article can be found in this GitHub repository.\nForwarding Logs to Elasticsearch APISIX can directly forward logs to Elasticsearch through the elasticsearch-logger plugin. For this example, we will deploy APISIX, Elasticsearch, and our upstream applications (two Nginx containers).\n Sample system with two upstream services, APISIX, and ElasticsearchSee the GitHub repo for the complete Docker Compose file\n  The elasticsearch-logger plugin can be enabled globally by configuring it on a global rule:\ncurl localhost:9180/apisix/admin/global_rules/log_all -X PUT -d ' { \"plugins\": { \"elasticsearch-logger\": { \"endpoint_addr\": \"http://elasticsearch:9200\", \"field\": { \"index\": \"gateway\", \"type\": \"logs\" }, \"ssl_verify\": false, \"timeout\": 60, \"retry_delay\": 1, \"buffer_duration\": 60, \"max_retry_count\": 0, \"batch_max_size\": 5, \"inactive_timeout\": 5 } } }'  Note: APISIX only supports ELK stack version 7.x. This article uses the version v7.17.1.\n With the above configuration, all logs will be forwarded to Elasticsearch in batches of five. If we send a request to Elasticsearch, we can see that it builds an index with the received logs:\ncurl -X GET \"http://127.0.0.1:9200/gateway/_search\" | jq { \"took\": 5, \"timed_out\": false, \"_shards\": { \"total\": 1, \"successful\": 1, \"skipped\": 0, \"failed\": 0 }, \"hits\": { \"total\": { \"value\": 13, \"relation\": \"eq\" }, \"max_score\": 1, \"hits\": [ { \"_index\": \"gateway\", \"_type\": \"log\", \"_id\": \"mon0KooBf0okahNeFIxr\", \"_score\": 1, \"_source\": { \"upstream_latency\": 5, \"request\": { \"method\": \"GET\", \"url\": \"http://localhost:9080/products/washer\", \"uri\": \"/products/washer\", \"querystring\": {}, \"size\": 93, \"headers\": { \"accept\": \"*/*\", \"user-agent\": \"curl/7.88.1\", \"host\": \"localhost:9080\" } }, \"route_id\": \"routes#1\", \"client_ip\": \"172.20.0.1\", \"response\": { \"status\": 200, \"size\": 190, \"headers\": { \"content-length\": \"27\", \"content-type\": \"text/plain; charset=utf-8\", \"date\": \"Fri, 25 Aug 2023 04:29:08 GMT\", \"server\": \"APISIX/3.4.1\", \"connection\": \"close\" } }, \"apisix_latency\": 27.000064849854, \"upstream\": \"172.20.0.5:80\", \"start_time\": 1692937748072, \"service_id\": \"\", \"server\": { \"version\": \"3.4.1\", \"hostname\": \"7f3bcc429d92\" }, \"latency\": 32.000064849854 } } ] } } Analyzing the Logs with Kibana Storing and indexing large volumes of logs is not useful on its own. That is why we will use Kibana to analyze and drive insights from these logs.\n Kibana pulls the indexed data from ElasticsearchSee the GitHub repo for the complete Docker Compose file\n  As mentioned, Kibana supports logs from Elasticsearch out-of-the-box. Once we deploy Kibana, we can go ahead and create an index pattern for the data we already have in Elasticsearch:\n Create an index pattern for the data in ElasticsearchThis should be available in /app/management/kibana/indexPatterns\n  We created the index “gateway” in Elasticsearch, and we can add a pattern to match this index:\n Match the \"gateway\" indexLearn more about index patterns from the official Kibana docs\n  Now, if you go back to the Discover page, you will be able to see the indexed logs from APISIX:\n Indexed logs from ElasticsearchThis should be available in /app/discover\n  You can search through these logs easily now and can create visualizations and dashboards or even use machine learning to find anomalies or security issues.\n Chart visualizing the percentage of requests to each pathYou can learn more about creating visualizations from the official Kibana docs\n  Customizing APISIX Logs So far, we have not explicitly mentioned what should be logged from APISIX. But most of APISIX’s logger plugins, including the elasticsearch-logger plugin, support custom log formats.\nTo modify the logs, you can configure the log_format attribute in the plugin with key-value pairs representing the data to be logged, as shown below:\ncurl localhost:9180/apisix/admin/global_rules/log_all -X PUT -d ' { \"plugins\": { \"elasticsearch-logger\": { \"endpoint_addr\": \"http://elasticsearch:9200\", \"field\": { \"index\": \"gateway\", \"type\": \"logs\" }, \"ssl_verify\": false, \"timeout\": 60, \"retry_delay\": 1, \"buffer_duration\": 60, \"max_retry_count\": 0, \"batch_max_size\": 5, \"inactive_timeout\": 5, \"log_format\": { \"host\": \"$host\", \"timestamp\": \"$time_iso8601\", \"client_ip\": \"$remote_addr\" } } } }' log_format supports custom APISIX and Nginx variables, as shown above. These variables can be used with the $ prefix.\nConsidering Scale and Performance Most practical systems that require something like the ELK stack for storing and managing logs would be large and distributed. Such systems would have logs coming in from multiple different services and even multiple instances of the same service as opposed to our above examples that just focused on APISIX logs.\nIn such scenarios, a robust data pipeline should be built to collect, aggregate, and preprocess these logs before sending them to Elasticsearch. This is where the L in ELK, Logstash, comes in.\nLogstash can collect data from multiple different sources through multiple different formats. Logstash can then use filters to transform and aggregate data into a standard format, which is often useful in large distributed systems for better analysis.\n The ELK stackThe ELK stack is widely used as the observability platform for large distributed systems\n  APISIX supports exporting logs through HTTP and TCP with the http-logger and tcp-logger plugins. Logstash can be configured to collect these logs and forward them to Elasticsearch after processing.\nThese plugins can be configured similarly to the elasticsearch-logger plugin. The example below shows how you can configure the http-logger plugin:\ncurl localhost:9180/apisix/admin/global_rules/log_all -X PUT -d ' { \"plugins\": { \"http-logger\": { \"uri\": \"http://logstash:8080\", \"timeout\": 60 } } }' You can also use tools outside the ELK stack, like Apache Kafka, to build your data pipelines. This can be useful when handling high traffic fluctuations to reduce the load on Elasticsearch. Logstash can also achieve this, and it might work better because it is part of the ELK stack, and each tool in the stack is designed to be interoperable.\nAPISIX can directly export logs to a Kafka cluster using the kafka-logger plugin.\nThere is also another set of tools called Beats, which is also considered to be a part of the ELK stack (the BELK stack?). Beats are agents that can be deployed on different systems to ship data from these systems. Filebeat is such an agent that sends log files from servers to the rest of the ELK stack.\n Using Filebeat to export logs to LogstashThere are also other shippers available\n  APISIX can export logs to files with the file-logger plugin. However, using log files and Filebeat for exporting APISIX logs can result in reduced performance because of the frequent write cycles with the disk.\nGoing Further We have only scratched the surface of how you can leverage the data from APISIX logs. But this depends solely on how you use APISIX within your system and your existing observability setup. You can learn more about using the ELK stack from the official website.\nYou can also use other observability tools if you don’t want to use the ELK stack or already use another stack. APISIX has logging plugins that directly export logs to tools and platforms like Apache SkyWalking, Splunk, and Google Cloud.\n","wordCount":"1385","inLanguage":"en","image":"https://navendu.me/images/apisix-logs-elk/elk-banner.jpg","datePublished":"2023-08-28T09:05:46+05:30","dateModified":"2023-09-26T16:25:00+05:30","author":{"@type":"Person","name":"Navendu Pottekkat"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://navendu.me/posts/apisix-logs-elk/"},"publisher":{"@type":"Person","name":"Navendu Pottekkat","logo":{"@type":"ImageObject","url":"https://navendu.me/favicon.ico"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href=https://navendu.me/ accesskey=h title="Navendu Pottekkat (Alt + H)">Navendu Pottekkat</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://navendu.me/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://navendu.me/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://navendu.me/dailies/ title="Daily Logs"><span>Daily Logs</span></a></li><li><a href=https://navendu.me/about/ title=About><span>About</span></a></li><li><a href=https://navendu.me/subscribe/ title=Subscribe><span>Subscribe</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://navendu.me/>Home</a>&nbsp;»&nbsp;<a href=https://navendu.me/posts/>Posts</a></div><h1 class=post-title>Combing through APISIX Logs with the Elastic (ELK) Stack</h1><div class=post-meta><span title="2023-08-28 09:05:46 +0530 +0530">August 28, 2023</span>&nbsp;·&nbsp;7 min&nbsp;|&nbsp;<a href=https://github.com/pottekkat/personal-website/blob/hugo/content/posts/apisix-logs-elk.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=lazy src=https://navendu.me/images/apisix-logs-elk/elk-banner.jpg alt="A photo of an elk in the wild."><p>The Elasticsearch, Logstash, Kibana (ELK) stack is popularly used for logging in complex systems.</p></figure><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Combing through APISIX Logs with the Elastic (ELK) Stack on twitter" href="https://twitter.com/intent/tweet/?text=Combing%20through%20APISIX%20Logs%20with%20the%20Elastic%20%28ELK%29%20Stack&url=https%3a%2f%2fnavendu.me%2fposts%2fapisix-logs-elk%2f&hashtags=apacheapisix%2ctutorials%2celasticsearch%2cmonitoring"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Combing through APISIX Logs with the Elastic (ELK) Stack on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fnavendu.me%2fposts%2fapisix-logs-elk%2f&title=Combing%20through%20APISIX%20Logs%20with%20the%20Elastic%20%28ELK%29%20Stack&summary=Combing%20through%20APISIX%20Logs%20with%20the%20Elastic%20%28ELK%29%20Stack&source=https%3a%2f%2fnavendu.me%2fposts%2fapisix-logs-elk%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Combing through APISIX Logs with the Elastic (ELK) Stack on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fnavendu.me%2fposts%2fapisix-logs-elk%2f&title=Combing%20through%20APISIX%20Logs%20with%20the%20Elastic%20%28ELK%29%20Stack"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Combing through APISIX Logs with the Elastic (ELK) Stack on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fnavendu.me%2fposts%2fapisix-logs-elk%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Combing through APISIX Logs with the Elastic (ELK) Stack on whatsapp" href="https://api.whatsapp.com/send?text=Combing%20through%20APISIX%20Logs%20with%20the%20Elastic%20%28ELK%29%20Stack%20-%20https%3a%2f%2fnavendu.me%2fposts%2fapisix-logs-elk%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Combing through APISIX Logs with the Elastic (ELK) Stack on telegram" href="https://telegram.me/share/url?text=Combing%20through%20APISIX%20Logs%20with%20the%20Elastic%20%28ELK%29%20Stack&url=https%3a%2f%2fnavendu.me%2fposts%2fapisix-logs-elk%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#forwarding-logs-to-elasticsearch aria-label="Forwarding Logs to Elasticsearch">Forwarding Logs to Elasticsearch</a></li><li><a href=#analyzing-the-logs-with-kibana aria-label="Analyzing the Logs with Kibana">Analyzing the Logs with Kibana</a></li><li><a href=#customizing-apisix-logs aria-label="Customizing APISIX Logs">Customizing APISIX Logs</a></li><li><a href=#considering-scale-and-performance aria-label="Considering Scale and Performance">Considering Scale and Performance</a></li><li><a href=#going-further aria-label="Going Further">Going Further</a></li></ul></div></details></div><div class=post-content><p>In most applications, <a href="https://apisix.apache.org/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=combing-through-apisix-logs-with-the-elastic-elk-stack" target=_blank>Apache APISIX</a>, the API gateway, sits in front of the backend services and acts as a single entry point. This allows application developers to use APISIX logs to provide insights into how their system and APISIX perform in real time.</p><p>Developers can also gather data from the logs and use it to improve the reliability and security of their applications. For example, data on the latency of different services can be used to identify issues and bottlenecks in your applications.</p><p>Additionally, these logs could also help handle some business-specific scenarios at the API gateway level, like user behavior analysis. However, it might not be as robust as event-driven trackers.</p><p>But gathering these logs and making them useful can be a difficult task. Even though I am a big fan of going through large log files using basic search tools, it often lacks trivial ways to search, filter, visualize, and gather insights needed to manage complex applications.</p><p>The <a href="https://www.elastic.co/elastic-stack?utm_source=navendu_blog&utm_medium=referral&utm_campaign=combing-through-apisix-logs-with-the-elastic-elk-stack" target=_blank>Elastic (ELK) stack</a> is a widely used observability stack for such applications. It primarily consists of three tools:</p><ul><li><strong>Elasticsearch</strong>: <a href="https://www.elastic.co/elasticsearch?utm_source=navendu_blog&utm_medium=referral&utm_campaign=combing-through-apisix-logs-with-the-elastic-elk-stack" target=_blank>A JSON-based datastore</a> that stores and indexes data. In the ELK stack, it is used to store and search through large amounts of logs in real time.</li><li><strong>Logstash</strong>: <a href="https://www.elastic.co/logstash?utm_source=navendu_blog&utm_medium=referral&utm_campaign=combing-through-apisix-logs-with-the-elastic-elk-stack" target=_blank>A preprocessor for Elasticsearch</a> that takes data from different sources, transforms it, and stores it in an external service (usually Elasticsearch in the ELK stack).</li><li><strong>Kibana</strong>: <a href="https://www.elastic.co/kibana?utm_source=navendu_blog&utm_medium=referral&utm_campaign=combing-through-apisix-logs-with-the-elastic-elk-stack" target=_blank>A web-based dashboard</a> that lets you access, visualize, analyze (and more) the data built and indexed by Elasticsearch.</li></ul><p>These tools can be used independently outside this particular stack but are tailored to work together.</p><p>Apache APISIX supports both these use cases out of the box through built-in plugins. This article will examine how you can configure these plugins in APISIX to work with the ELK stack. We will also look at how this system scales as applications get bigger.</p><p>The complete configuration used in this article can be found in <a href="https://github.com/pottekkat/elk-log-apisix?utm_source=navendu_blog&utm_medium=referral&utm_campaign=combing-through-apisix-logs-with-the-elastic-elk-stack" target=_blank>this GitHub repository</a>.</p><h2 id=forwarding-logs-to-elasticsearch>Forwarding Logs to Elasticsearch<a hidden class=anchor aria-hidden=true href=#forwarding-logs-to-elasticsearch>#</a></h2><p>APISIX can directly forward logs to Elasticsearch through the <a href="https://apisix.apache.org/docs/apisix/plugins/elasticsearch-logger/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=combing-through-apisix-logs-with-the-elastic-elk-stack" target=_blank>elasticsearch-logger</a> plugin. For this example, we will deploy APISIX, Elasticsearch, and our upstream applications (two Nginx containers).</p><figure class=align-center><a href=/images/apisix-logs-elk/apisix-elasticsearch.png target=_blank><img loading=lazy src=/images/apisix-logs-elk/apisix-elasticsearch.png#center alt="Sample system with two upstream services, APISIX, and Elasticsearch"></a><figcaption>Sample system with two upstream services, APISIX, and Elasticsearch<p>See <a href=https://github.com/pottekkat/elk-log-apisix>the GitHub repo</a> for the complete Docker Compose file</p></figcaption></figure><p>The <code>elasticsearch-logger</code> plugin can be enabled globally by configuring it on a <a href="https://apisix.apache.org/docs/apisix/next/terminology/global-rule/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=combing-through-apisix-logs-with-the-elastic-elk-stack" target=_blank>global rule</a>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>curl localhost:9180/apisix/admin/global_rules/log_all -X PUT -d <span style=color:#e6db74>&#39;
</span><span style=color:#e6db74>{
</span><span style=color:#e6db74>  &#34;plugins&#34;: {
</span><span style=color:#e6db74>    &#34;elasticsearch-logger&#34;: {
</span><span style=color:#e6db74>      &#34;endpoint_addr&#34;: &#34;http://elasticsearch:9200&#34;,
</span><span style=color:#e6db74>      &#34;field&#34;: {
</span><span style=color:#e6db74>        &#34;index&#34;: &#34;gateway&#34;,
</span><span style=color:#e6db74>        &#34;type&#34;: &#34;logs&#34;
</span><span style=color:#e6db74>      },
</span><span style=color:#e6db74>      &#34;ssl_verify&#34;: false,
</span><span style=color:#e6db74>      &#34;timeout&#34;: 60,
</span><span style=color:#e6db74>      &#34;retry_delay&#34;: 1,
</span><span style=color:#e6db74>      &#34;buffer_duration&#34;: 60,
</span><span style=color:#e6db74>      &#34;max_retry_count&#34;: 0,
</span><span style=color:#e6db74>      &#34;batch_max_size&#34;: 5,
</span><span style=color:#e6db74>      &#34;inactive_timeout&#34;: 5
</span><span style=color:#e6db74>    }
</span><span style=color:#e6db74>  }
</span><span style=color:#e6db74>}&#39;</span>
</code></pre></div><blockquote><p><strong>Note</strong>: APISIX only supports ELK stack version 7.x. This article uses the version <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/explicit-mapping.html?utm_source=navendu_blog&utm_medium=referral&utm_campaign=combing-through-apisix-logs-with-the-elastic-elk-stack" target=_blank>v7.17.1</a>.</p></blockquote><p>With the above configuration, all logs will be forwarded to Elasticsearch in batches of five. If we send a request to Elasticsearch, we can see that it builds an index with the received logs:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>curl -X GET <span style=color:#e6db74>&#34;http://127.0.0.1:9200/gateway/_search&#34;</span> | jq
</code></pre></div><div class=highlight title=output><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;took&#34;</span>: <span style=color:#ae81ff>5</span>,
  <span style=color:#f92672>&#34;timed_out&#34;</span>: <span style=color:#66d9ef>false</span>,
  <span style=color:#f92672>&#34;_shards&#34;</span>: {
    <span style=color:#f92672>&#34;total&#34;</span>: <span style=color:#ae81ff>1</span>,
    <span style=color:#f92672>&#34;successful&#34;</span>: <span style=color:#ae81ff>1</span>,
    <span style=color:#f92672>&#34;skipped&#34;</span>: <span style=color:#ae81ff>0</span>,
    <span style=color:#f92672>&#34;failed&#34;</span>: <span style=color:#ae81ff>0</span>
  },
  <span style=color:#f92672>&#34;hits&#34;</span>: {
    <span style=color:#f92672>&#34;total&#34;</span>: {
      <span style=color:#f92672>&#34;value&#34;</span>: <span style=color:#ae81ff>13</span>,
      <span style=color:#f92672>&#34;relation&#34;</span>: <span style=color:#e6db74>&#34;eq&#34;</span>
    },
    <span style=color:#f92672>&#34;max_score&#34;</span>: <span style=color:#ae81ff>1</span>,
    <span style=color:#f92672>&#34;hits&#34;</span>: [
      {
        <span style=color:#f92672>&#34;_index&#34;</span>: <span style=color:#e6db74>&#34;gateway&#34;</span>,
        <span style=color:#f92672>&#34;_type&#34;</span>: <span style=color:#e6db74>&#34;log&#34;</span>,
        <span style=color:#f92672>&#34;_id&#34;</span>: <span style=color:#e6db74>&#34;mon0KooBf0okahNeFIxr&#34;</span>,
        <span style=color:#f92672>&#34;_score&#34;</span>: <span style=color:#ae81ff>1</span>,
        <span style=color:#f92672>&#34;_source&#34;</span>: {
          <span style=color:#f92672>&#34;upstream_latency&#34;</span>: <span style=color:#ae81ff>5</span>,
          <span style=color:#f92672>&#34;request&#34;</span>: {
            <span style=color:#f92672>&#34;method&#34;</span>: <span style=color:#e6db74>&#34;GET&#34;</span>,
            <span style=color:#f92672>&#34;url&#34;</span>: <span style=color:#e6db74>&#34;http://localhost:9080/products/washer&#34;</span>,
            <span style=color:#f92672>&#34;uri&#34;</span>: <span style=color:#e6db74>&#34;/products/washer&#34;</span>,
            <span style=color:#f92672>&#34;querystring&#34;</span>: {},
            <span style=color:#f92672>&#34;size&#34;</span>: <span style=color:#ae81ff>93</span>,
            <span style=color:#f92672>&#34;headers&#34;</span>: {
              <span style=color:#f92672>&#34;accept&#34;</span>: <span style=color:#e6db74>&#34;*/*&#34;</span>,
              <span style=color:#f92672>&#34;user-agent&#34;</span>: <span style=color:#e6db74>&#34;curl/7.88.1&#34;</span>,
              <span style=color:#f92672>&#34;host&#34;</span>: <span style=color:#e6db74>&#34;localhost:9080&#34;</span>
            }
          },
          <span style=color:#f92672>&#34;route_id&#34;</span>: <span style=color:#e6db74>&#34;routes#1&#34;</span>,
          <span style=color:#f92672>&#34;client_ip&#34;</span>: <span style=color:#e6db74>&#34;172.20.0.1&#34;</span>,
          <span style=color:#f92672>&#34;response&#34;</span>: {
            <span style=color:#f92672>&#34;status&#34;</span>: <span style=color:#ae81ff>200</span>,
            <span style=color:#f92672>&#34;size&#34;</span>: <span style=color:#ae81ff>190</span>,
            <span style=color:#f92672>&#34;headers&#34;</span>: {
              <span style=color:#f92672>&#34;content-length&#34;</span>: <span style=color:#e6db74>&#34;27&#34;</span>,
              <span style=color:#f92672>&#34;content-type&#34;</span>: <span style=color:#e6db74>&#34;text/plain; charset=utf-8&#34;</span>,
              <span style=color:#f92672>&#34;date&#34;</span>: <span style=color:#e6db74>&#34;Fri, 25 Aug 2023 04:29:08 GMT&#34;</span>,
              <span style=color:#f92672>&#34;server&#34;</span>: <span style=color:#e6db74>&#34;APISIX/3.4.1&#34;</span>,
              <span style=color:#f92672>&#34;connection&#34;</span>: <span style=color:#e6db74>&#34;close&#34;</span>
            }
          },
          <span style=color:#f92672>&#34;apisix_latency&#34;</span>: <span style=color:#ae81ff>27.000064849854</span>,
          <span style=color:#f92672>&#34;upstream&#34;</span>: <span style=color:#e6db74>&#34;172.20.0.5:80&#34;</span>,
          <span style=color:#f92672>&#34;start_time&#34;</span>: <span style=color:#ae81ff>1692937748072</span>,
          <span style=color:#f92672>&#34;service_id&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,
          <span style=color:#f92672>&#34;server&#34;</span>: {
            <span style=color:#f92672>&#34;version&#34;</span>: <span style=color:#e6db74>&#34;3.4.1&#34;</span>,
            <span style=color:#f92672>&#34;hostname&#34;</span>: <span style=color:#e6db74>&#34;7f3bcc429d92&#34;</span>
          },
          <span style=color:#f92672>&#34;latency&#34;</span>: <span style=color:#ae81ff>32.000064849854</span>
        }
      }
    ]
  }
}
</code></pre></div><h2 id=analyzing-the-logs-with-kibana>Analyzing the Logs with Kibana<a hidden class=anchor aria-hidden=true href=#analyzing-the-logs-with-kibana>#</a></h2><p>Storing and indexing large volumes of logs is not useful on its own. That is why we will use Kibana to analyze and drive insights from these logs.</p><figure class=align-center><a href=/images/apisix-logs-elk/elasticsearch-kibana.png target=_blank><img loading=lazy src=/images/apisix-logs-elk/elasticsearch-kibana.png#center alt="Kibana pulls the indexed data from Elasticsearch"></a><figcaption>Kibana pulls the indexed data from Elasticsearch<p>See <a href=https://github.com/pottekkat/elk-log-apisix>the GitHub repo</a> for the complete Docker Compose file</p></figcaption></figure><p>As mentioned, Kibana supports logs from Elasticsearch out-of-the-box. Once we deploy Kibana, we can go ahead and <a href="https://www.elastic.co/guide/en/kibana/7.17/index-patterns.html?utm_source=navendu_blog&utm_medium=referral&utm_campaign=combing-through-apisix-logs-with-the-elastic-elk-stack" target=_blank>create an index pattern</a> for the data we already have in Elasticsearch:</p><figure class=align-center><a href=/images/apisix-logs-elk/create-index-pattern.png target=_blank><img loading=lazy src=/images/apisix-logs-elk/create-index-pattern.png#center alt="Create an index pattern for the data in Elasticsearch"></a><figcaption>Create an index pattern for the data in Elasticsearch<p>This should be available in <a href=http://localhost:5601/app/management/kibana/indexPatterns>/app/management/kibana/indexPatterns</a></p></figcaption></figure><p>We created the index &ldquo;gateway&rdquo; in Elasticsearch, and we can add a pattern to match this index:</p><figure class=align-center><a href=/images/apisix-logs-elk/create-index-pattern-2.png target=_blank><img loading=lazy src=/images/apisix-logs-elk/create-index-pattern-2.png#center alt="Match the &amp;ldquo;gateway&amp;rdquo; index"></a><figcaption>Match the "gateway" index<p>Learn more about index patterns from the <a href=https://www.elastic.co/guide/en/kibana/7.17/index-patterns.html>official Kibana docs</a></p></figcaption></figure><p>Now, if you go back to the Discover page, you will be able to see the indexed logs from APISIX:</p><figure class=align-center><a href=/images/apisix-logs-elk/discover.png target=_blank><img loading=lazy src=/images/apisix-logs-elk/discover.png#center alt="Indexed logs from Elasticsearch"></a><figcaption>Indexed logs from Elasticsearch<p>This should be available in <a href=http://localhost:5601/app/discover>/app/discover</a></p></figcaption></figure><p>You can search through these logs easily now and can create visualizations and dashboards or even use machine learning to find anomalies or security issues.</p><figure class=align-center><a href=/images/apisix-logs-elk/visualize.png target=_blank><img loading=lazy src=/images/apisix-logs-elk/visualize.png#center alt="Chart visualizing the percentage of requests to each path"></a><figcaption>Chart visualizing the percentage of requests to each path<p>You can learn more about creating visualizations from the <a href=https://www.elastic.co/guide/en/kibana/7.17/dashboard.html>official Kibana docs</a></p></figcaption></figure><h2 id=customizing-apisix-logs>Customizing APISIX Logs<a hidden class=anchor aria-hidden=true href=#customizing-apisix-logs>#</a></h2><p>So far, we have not explicitly mentioned what should be logged from APISIX. But most of APISIX&rsquo;s logger plugins, including the <code>elasticsearch-logger</code> plugin, support <a href="https://apisix.apache.org/docs/apisix/plugins/elasticsearch-logger/#metadata?utm_source=navendu_blog&utm_medium=referral&utm_campaign=combing-through-apisix-logs-with-the-elastic-elk-stack" target=_blank>custom log formats</a>.</p><p>To modify the logs, you can configure the <code>log_format</code> attribute in the plugin with key-value pairs representing the data to be logged, as shown below:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>curl localhost:9180/apisix/admin/global_rules/log_all -X PUT -d <span style=color:#e6db74>&#39;
</span><span style=color:#e6db74>{
</span><span style=color:#e6db74>  &#34;plugins&#34;: {
</span><span style=color:#e6db74>    &#34;elasticsearch-logger&#34;: {
</span><span style=color:#e6db74>      &#34;endpoint_addr&#34;: &#34;http://elasticsearch:9200&#34;,
</span><span style=color:#e6db74>      &#34;field&#34;: {
</span><span style=color:#e6db74>        &#34;index&#34;: &#34;gateway&#34;,
</span><span style=color:#e6db74>        &#34;type&#34;: &#34;logs&#34;
</span><span style=color:#e6db74>      },
</span><span style=color:#e6db74>      &#34;ssl_verify&#34;: false,
</span><span style=color:#e6db74>      &#34;timeout&#34;: 60,
</span><span style=color:#e6db74>      &#34;retry_delay&#34;: 1,
</span><span style=color:#e6db74>      &#34;buffer_duration&#34;: 60,
</span><span style=color:#e6db74>      &#34;max_retry_count&#34;: 0,
</span><span style=color:#e6db74>      &#34;batch_max_size&#34;: 5,
</span><span style=color:#e6db74>      &#34;inactive_timeout&#34;: 5,
</span><span style=display:block;width:100%;background-color:#3c3d38><span style=color:#e6db74>      &#34;log_format&#34;: {
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style=color:#e6db74>        &#34;host&#34;: &#34;$host&#34;,
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style=color:#e6db74>        &#34;timestamp&#34;: &#34;$time_iso8601&#34;,
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style=color:#e6db74>        &#34;client_ip&#34;: &#34;$remote_addr&#34;
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style=color:#e6db74>      }
</span></span><span style=color:#e6db74>    }
</span><span style=color:#e6db74>  }
</span><span style=color:#e6db74>}&#39;</span>
</code></pre></div><p><code>log_format</code> supports custom APISIX and Nginx variables, as shown above. These variables can be used with the <code>$</code> prefix.</p><h2 id=considering-scale-and-performance>Considering Scale and Performance<a hidden class=anchor aria-hidden=true href=#considering-scale-and-performance>#</a></h2><p>Most practical systems that require something like the ELK stack for storing and managing logs would be large and distributed. Such systems would have logs coming in from multiple different services and even multiple instances of the same service as opposed to our above examples that just focused on APISIX logs.</p><p>In such scenarios, a robust data pipeline should be built to collect, aggregate, and preprocess these logs before sending them to Elasticsearch. This is where the L in ELK, Logstash, comes in.</p><p>Logstash can collect data from <a href="https://www.elastic.co/guide/en/logstash/7.17/input-plugins.html?utm_source=navendu_blog&utm_medium=referral&utm_campaign=combing-through-apisix-logs-with-the-elastic-elk-stack" target=_blank>multiple different sources</a> through multiple different formats. Logstash can then use <a href="https://www.elastic.co/guide/en/logstash/7.17/pipeline.html#_filters?utm_source=navendu_blog&utm_medium=referral&utm_campaign=combing-through-apisix-logs-with-the-elastic-elk-stack" target=_blank>filters</a> to transform and aggregate data into a standard format, which is often useful in large distributed systems for better analysis.</p><figure class=align-center><a href=/images/apisix-logs-elk/elk-minimum.png target=_blank><img loading=lazy src=/images/apisix-logs-elk/elk-minimum.png#center alt="The ELK stack"></a><figcaption>The ELK stack<p>The ELK stack is widely used as the observability platform for large distributed systems</p></figcaption></figure><p>APISIX supports exporting logs through HTTP and TCP with the <a href="https://apisix.apache.org/docs/apisix/plugins/http-logger/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=combing-through-apisix-logs-with-the-elastic-elk-stack" target=_blank>http-logger</a> and <a href="https://apisix.apache.org/docs/apisix/plugins/tcp-logger/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=combing-through-apisix-logs-with-the-elastic-elk-stack" target=_blank>tcp-logger</a> plugins. Logstash can be configured to collect these logs and forward them to Elasticsearch after processing.</p><p>These plugins can be configured similarly to the <code>elasticsearch-logger</code> plugin. The example below shows how you can configure the <code>http-logger</code> plugin:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>curl localhost:9180/apisix/admin/global_rules/log_all -X PUT -d <span style=color:#e6db74>&#39;
</span><span style=color:#e6db74>{
</span><span style=color:#e6db74>  &#34;plugins&#34;: {
</span><span style=color:#e6db74>    &#34;http-logger&#34;: {
</span><span style=color:#e6db74>      &#34;uri&#34;: &#34;http://logstash:8080&#34;,
</span><span style=color:#e6db74>      &#34;timeout&#34;: 60
</span><span style=color:#e6db74>    }
</span><span style=color:#e6db74>  }
</span><span style=color:#e6db74>}&#39;</span>
</code></pre></div><p>You can also use tools outside the ELK stack, like <a href="https://kafka.apache.org/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=combing-through-apisix-logs-with-the-elastic-elk-stack" target=_blank>Apache Kafka</a>, to build your data pipelines. This can be useful when handling high traffic fluctuations to reduce the load on Elasticsearch. Logstash can also achieve this, and it might work better because it is part of the ELK stack, and each tool in the stack is designed to be interoperable.</p><p>APISIX can directly export logs to a Kafka cluster using the <a href="https://apisix.apache.org/docs/apisix/plugins/kafka-logger/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=combing-through-apisix-logs-with-the-elastic-elk-stack" target=_blank>kafka-logger</a> plugin.</p><p>There is also another set of tools called <a href="https://www.elastic.co/beats/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=combing-through-apisix-logs-with-the-elastic-elk-stack" target=_blank>Beats</a>, which is also considered to be a part of the ELK stack (the BELK stack?). Beats are agents that can be deployed on different systems to ship data from these systems. <a href="https://www.elastic.co/beats/filebeat?utm_source=navendu_blog&utm_medium=referral&utm_campaign=combing-through-apisix-logs-with-the-elastic-elk-stack" target=_blank>Filebeat</a> is such an agent that sends log files from servers to the rest of the ELK stack.</p><figure class=align-center><a href=/images/apisix-logs-elk/elk-with-beats.png target=_blank><img loading=lazy src=/images/apisix-logs-elk/elk-with-beats.png#center alt="Using Filebeat to export logs to Logstash"></a><figcaption>Using Filebeat to export logs to Logstash<p>There are also <a href=https://www.elastic.co/beats>other shippers</a> available</p></figcaption></figure><p>APISIX can export logs to files with the <a href="https://apisix.apache.org/docs/apisix/plugins/file-logger/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=combing-through-apisix-logs-with-the-elastic-elk-stack" target=_blank>file-logger</a> plugin. However, using log files and Filebeat for exporting APISIX logs can result in reduced performance because of the frequent write cycles with the disk.</p><h2 id=going-further>Going Further<a hidden class=anchor aria-hidden=true href=#going-further>#</a></h2><p>We have only scratched the surface of how you can leverage the data from APISIX logs. But this depends solely on how you use APISIX within your system and your existing observability setup. You can learn more about using the ELK stack from the <a href="https://www.elastic.co/elastic-stack?utm_source=navendu_blog&utm_medium=referral&utm_campaign=combing-through-apisix-logs-with-the-elastic-elk-stack" target=_blank>official website</a>.</p><p>You can also use other observability tools if you don&rsquo;t want to use the ELK stack or already use another stack. APISIX has logging plugins that directly export logs to tools and platforms like <a href="https://apisix.apache.org/docs/apisix/plugins/skywalking-logger/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=combing-through-apisix-logs-with-the-elastic-elk-stack" target=_blank>Apache SkyWalking</a>, <a href="https://apisix.apache.org/docs/apisix/plugins/splunk-hec-logging/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=combing-through-apisix-logs-with-the-elastic-elk-stack" target=_blank>Splunk</a>, and <a href="https://apisix.apache.org/docs/apisix/plugins/google-cloud-logging/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=combing-through-apisix-logs-with-the-elastic-elk-stack" target=_blank>Google Cloud</a>.</p><h2>Related Posts</h2><ul><li><a href=/posts/tinier-apisix-plugin/>A "Tinier" APISIX Plugin</a></li><li><a href=/posts/managing-apisix-declaratively/>Managing APISIX Declaratively with ADC</a></li><li><a href=/posts/rate-limit/>Rate Limit Your APIs With Apache APISIX</a></li></ul><section class=subscribe-content><hr><p>Thank you for reading <i>"Combing through APISIX Logs with the Elastic (ELK) Stack."</i></p><p>Subscribe via <a href=/subscribe>email</a> or
<a href=/index.xml target=_blank>RSS feed</a> to be the first to receive
my content.</p><p>If you liked this post, check out my <a href=/categories/featured>featured posts</a> or learn more <a href=/about>about me</a>.</p></section><section class=subscription-form><form action="https://navendu.us5.list-manage.com/subscribe/post-json?u=fb9ffeb3ee6bc8aaf1d5b8a98&id=5ff8367bc1&c=?" method=post autocomplete=off class=subscribe-form><div class=subscribe-input><input type=email name=EMAIL id=email required placeholder="Email Address ↵" title="Email Address"></div><input value=Subscribe type=submit class=subscribe-button title=Subscribe></form><section class=entry-content><div class=subscribe-message>Get a biweekly dose of tech news, curated content, and uninterrupted musings.</div></section></section><script>$(".subscribe-form").submit(function(d){var a,b,c;d.preventDefault(),a=$(this),b=a.attr("action"),c=a.attr("method"),$.ajax({type:c,url:b,data:a.serialize(),dataType:`jsonp`,success:function(b){b.result===`success`?(a.find(".subscribe-button").attr("value","Subscribed!"),$(".subscribe-message").html("Thank you for subscribing! Check your inbox and add me in your contacts to not miss an issue! <a target='_blank' href='https://twitter.com/intent/tweet?url=https%3A%2F%2Fnavendu.me&text=I%20just%20subscribed%20to%20@sudo_navendu%27s%20blog%21%20Check%20it%20out%21&hashtags=OpenSource%2CDevelopers%2CDEVCommunity'>Tweet about it</a>!"),$(".subscribe-form :input").prop("disabled",!0)):(a.find(".subscribe-button").attr("value","Failed to Subscribe! Click again to retry"),$(".subscribe-message").html("There was an error subscribing you to my blog. "+b.msg+"."),a[0].reset()),console.log(b)},error:function(b){console.log("An error occurred."),console.log(b),a[0].reset()}})})</script></div><footer class=post-footer><ul class=post-tags><li><a href=https://navendu.me/tags/apache-apisix/>apache apisix</a></li><li><a href=https://navendu.me/tags/tutorials/>tutorials</a></li><li><a href=https://navendu.me/tags/elasticsearch/>elasticsearch</a></li><li><a href=https://navendu.me/tags/monitoring/>monitoring</a></li></ul><nav class=paginav><a class=prev href=https://navendu.me/posts/fuse-search-upgrade/><span class=title>« Prev</span><br><span>Upgrading the Fuse.js Search Feature</span></a>
<a class=next href=https://navendu.me/posts/list-series-hugo/><span class=title>Next »</span><br><span>List Articles from a Series in Hugo</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Combing through APISIX Logs with the Elastic (ELK) Stack on twitter" href="https://twitter.com/intent/tweet/?text=Combing%20through%20APISIX%20Logs%20with%20the%20Elastic%20%28ELK%29%20Stack&url=https%3a%2f%2fnavendu.me%2fposts%2fapisix-logs-elk%2f&hashtags=apacheapisix%2ctutorials%2celasticsearch%2cmonitoring"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Combing through APISIX Logs with the Elastic (ELK) Stack on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fnavendu.me%2fposts%2fapisix-logs-elk%2f&title=Combing%20through%20APISIX%20Logs%20with%20the%20Elastic%20%28ELK%29%20Stack&summary=Combing%20through%20APISIX%20Logs%20with%20the%20Elastic%20%28ELK%29%20Stack&source=https%3a%2f%2fnavendu.me%2fposts%2fapisix-logs-elk%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Combing through APISIX Logs with the Elastic (ELK) Stack on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fnavendu.me%2fposts%2fapisix-logs-elk%2f&title=Combing%20through%20APISIX%20Logs%20with%20the%20Elastic%20%28ELK%29%20Stack"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Combing through APISIX Logs with the Elastic (ELK) Stack on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fnavendu.me%2fposts%2fapisix-logs-elk%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Combing through APISIX Logs with the Elastic (ELK) Stack on whatsapp" href="https://api.whatsapp.com/send?text=Combing%20through%20APISIX%20Logs%20with%20the%20Elastic%20%28ELK%29%20Stack%20-%20https%3a%2f%2fnavendu.me%2fposts%2fapisix-logs-elk%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Combing through APISIX Logs with the Elastic (ELK) Stack on telegram" href="https://telegram.me/share/url?text=Combing%20through%20APISIX%20Logs%20with%20the%20Elastic%20%28ELK%29%20Stack&url=https%3a%2f%2fnavendu.me%2fposts%2fapisix-logs-elk%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>This work by <a href=https://navendu.me/about/#about-me>Navendu Pottekkat</a></span>
<span>is licensed under <a rel=license href=http://creativecommons.org/licenses/by-sa/4.0 target=_blank>CC BY-SA 4.0</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerHTML='copy';function d(){a.innerHTML='copied!',setTimeout(()=>{a.innerHTML='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script><script>for(var els=document.getElementsByClassName("highlight"),i=0,title,code,newNode;i<els.length;i++)title=els[i].title,code=els[i].firstElementChild.firstElementChild,title.length&&(newNode=document.createElement("div"),newNode.textContent=title,newNode.classList.add("highlight-title"),code.parentNode.insertBefore(newNode,code))</script></body></html>