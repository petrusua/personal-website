<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>APISIX Service Mesh | Navendu Pottekkat</title><meta name=keywords content="amesh,apache apisix,service-mesh,istio"><meta name=description content="Apache APISIX is generally used to manage north-south traffic in Kubernetes and often sits at the edge of a cluster. With Amesh, APISIX is now a service mesh."><meta name=author content="Navendu Pottekkat"><link rel=canonical href=https://api7.ai/blog/apisix-service-mesh/><script defer data-domain=navendu.me src=/misc/js/script.js data-api=/misc/api/event></script><script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script><script></script><link crossorigin=anonymous href=/assets/css/stylesheet.66e3e513d75c2ff303648a5691fa6787b3c8f1dc4b3307618713a4dc494f0696.css integrity="sha256-ZuPlE9dcL/MDZIpWkfpnh7PI8dxLMwdhhxOk3ElPBpY=" rel="preload stylesheet" as=style><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://navendu.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://navendu.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://navendu.me/favicon-32x32.png><link rel=apple-touch-icon href=https://navendu.me/apple-touch-icon.png><link rel=mask-icon href=https://navendu.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="APISIX Service Mesh"><meta property="og:description" content="Apache APISIX is generally used to manage north-south traffic in Kubernetes and often sits at the edge of a cluster. With Amesh, APISIX is now a service mesh."><meta property="og:type" content="article"><meta property="og:url" content="https://navendu.me/posts/amesh/"><meta property="og:image" content="https://navendu.me/images/amesh/sidecar-banner.jpeg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-06-16T09:24:01+05:30"><meta property="article:modified_time" content="2023-06-16T13:59:59+05:30"><meta property="og:site_name" content="Navendu Pottekkat"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://navendu.me/images/amesh/sidecar-banner.jpeg"><meta name=twitter:title content="APISIX Service Mesh"><meta name=twitter:description content="Apache APISIX is generally used to manage north-south traffic in Kubernetes and often sits at the edge of a cluster. With Amesh, APISIX is now a service mesh."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://navendu.me/posts/"},{"@type":"ListItem","position":2,"name":"APISIX Service Mesh","item":"https://navendu.me/posts/amesh/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"APISIX Service Mesh","name":"APISIX Service Mesh","description":"Apache APISIX is generally used to manage north-south traffic in Kubernetes and often sits at the edge of a cluster. With Amesh, APISIX is now a service mesh.","keywords":["amesh","apache apisix","service-mesh","istio"],"articleBody":"Apache APISIX is primarily used to handle north-south traffic and often sits at the boundary between client applications and backend services.\nWith the APISIX Ingress controller, APISIX can also control the ingress-egress traffic in Kubernetes clusters with native configuration.\nBut as organizations embrace microservices, there is a new challenge to handle the east-west traffic between these microservices.\nService meshes like Istio solve this by removing the networking responsibility from the microservice developer, providing an additional L4/L7 networking layer.\nWith the new Amesh library and Istio, Apache APISIX can also be used as a service mesh, specifically as a data plane for Istio, bringing all its traffic management capabilities to service-to-service communication.\nIn this article, we will examine what Amesh is, how it was developed, and how it is used to bring APISIX into a service mesh.\nIstio and the xDS Protocol Istio is one of the most widely used service meshes.\nUnder the hood, Istio uses Envoy as the reverse proxy in its sidecar containers.\n Istio service meshIstio uses Envoy proxy as the data plane\n  Istio manages traffic by dynamically configuring the sidecars using Envoy's xDS APIs.\nThe xDS APIs are a way to configure Envoy with incremental changes instead of simple configurations with static files.\nAlthough these APIs were initially intended for configuring Envoy, the APIs have evolved to become a universal data plane API. Any data plane proxy can implement these APIs, and any control plane can use this API to work with these data plane proxies.\nIn Istio, this means that you can replace the default Envoy data plane with any data plane that implements the xDS APIs. So you can replace Envoy with APISIX to get its traffic management capabilities in a service mesh.\nBut APISIX does not support the xDS APIs out-of-the-box. And that’s where Amesh comes in.\nAmesh Amesh is a library that translates the data from Istio’s control plane to APISIX configuration.\n APISIX + Amesh + IstioAPISIX replaces Envoy as the data plane for Istio\n  Istio communicates to the data plane through the xDS APIs. Amesh supports these APIs and then converts them to APISIX configuration.\nThis is similar to how APISIX and the APISIX Ingress controller work. The Ingress controller converts the configurations defined using the Ingress or the Gateway API to APISIX format.\n APISIX + APISIX Ingress controllerThe Ingress controller translates configuration defined using the Kubernetes Ingress or Gateway APIs to APISIX configuration\n  Since the xDS APIs are supported by more service meshes like Linkerd and Open Service Mesh, APISIX can also work with them using the Amesh library. Amesh is still in the early stages of development and currently works with Istio v1.13.1.\nWith Amesh + APISIX, you can use Istio as you would typically. Once you configure traffic rules with Istio’s virtual service, APISIX can implement these rules.\nAPISIX’s extended capabilities come through its 80+ plugins. To use APISIX plugins with Istio, we deploy an Amesh control plane component called the Amesh controller.\nThe Amesh controller takes a plugin configuration defined with the AmeshPluginConfig CRD and converts it to an APISIX plugin configuration.\nAll of this will enable us to leverage the full capabilities of APISIX within sidecar containers.\nAPISIX + Istio Mesh Let’s put everything we learned about in action.\nWe will build the Amesh images, configure Istio to use APISIX sidecars, deploy Istio, and test everything by running a sample application.\nBuilding the Images We will build three images:\n amesh-iptables: used for creating an init container to set up some iptables rules. These rules are to direct all traffic through APISIX. amesh-sidecar: used for creating the sidecar container. amesh-controller: used for creating the Amesh controller control plane component. This controller is used to configure APISIX plugins.  First, clone the Amesh repo:\ngit clone https://github.com/api7/Amesh.git cd Amesh You can build and push these images to your own registry.\nAdd the address of your registry in an environment variable before you run the build, as shown below:\nexport REGISTRY=\"docker.io/navendu\" make prepare-images If you don’t want to build your own images, you can use these images:\ndocker pull navendup/amesh-iptables:dev docker pull navendup/amesh-sidecar:dev docker pull navendup/amesh-controller:latest Deploy Amesh Controller and Install CRDs We will use Helm to deploy everything to the Kubernetes cluster. I use minikube in these examples.\nWe will start by creating a new namespace istio-system:\nkubectl create namespace istio-system To deploy the Amesh controller, run:\nhelm install amesh-controller -n istio-system \\ ./controller/charts/amesh-controller You also need to install CRDs to work with the Amesh controller:\nkubectl apply -k controller/config/crd/ Configure and Deploy Istio + APISIX Before deploying the service mesh, we will set some environment variables:\nexport ISTIO_RELEASE=1.13.1 export REGISTRY=\"docker.io/navendup\" Then we will use Helm to deploy the service mesh:\nhelm install amesh \\ --namespace istio-system \\ --set pilot.image=istio/pilot:\"$ISTIO_RELEASE\" \\ --set global.proxy.privileged=true \\ --set global.proxy_init.image=\"$REGISTRY\"/amesh-iptables:dev \\ --set global.proxy.image=\"$REGISTRY\"/amesh-sidecar:dev \\ --set global.imagePullPolicy=IfNotPresent \\ --set global.hub=\"docker.io/istio\" \\ --set global.tag=\"$ISTIO_RELEASE\" \\ ./charts/amesh Now we have the service mesh and Amesh controller deployed. Next, let’s deploy a sample application to test our service mesh.\nDeploying Bookinfo We will use Istio’s Bookinfo sample app.\nFirst, we will add a label to the default namespace to automatically inject sidecars to any pod in the namespace:\nkubectl label ns default istio-injection=enabled Then we can deploy Bookinfo by running:\nkubectl apply -f e2e/bookinfo/bookinfo.yaml This will spin up the Bookinfo application, and each of the pods will have APISIX sidecars:\n$ kubectl get pods NAME READY STATUS RESTARTS AGE details-v1-79f774bdb9-cbn87 2/2 Running 0 55s productpage-v1-6b746f74dc-tntc8 2/2 Running 0 55s ratings-v1-b6994bb9-r5j45 2/2 Running 0 55s reviews-v1-545db77b95-n657s 2/2 Running 0 55s reviews-v2-7bf8c9648f-zn97s 2/2 Running 0 55s reviews-v3-84779c7bbc-wn8k2 2/2 Running 0 55s Testing the Mesh To access the Bookinfo application, we would need an ingress gateway.\nYou can use APISIX for this ingress gateway, but that’s for another time. For now, we can just use port-forward to access the product-page service:\nkubectl port-forward productpage-v1-6b746f74dc-tntc8 9080:9080 Now if we open up localhost:9080, we will be able to see our sample application.\n Bookinfo homepageThis uses the reviews-v3 service. If you refresh the page, it will cycle through the reviews service\n  Each time you refresh the page, the reviews are pulled from a different version of the reviews service (we deployed three versions).\nNow let’s apply a rule using virtual services that routes all traffic to v1 versions of the services.\nThe rule is self-explanatory, and it would look like this:\napiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: productpage spec: hosts: - productpage http: - route: - destination: host: productpage subset: v1 --- apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: reviews spec: hosts: - reviews http: - route: - destination: host: reviews subset: v1 --- apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: ratings spec: hosts: - ratings http: - route: - destination: host: ratings subset: v1 --- apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: details spec: hosts: - details http: - route: - destination: host: details subset: v1 --- You can apply it to your cluster by running:\nkubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.18/samples/bookinfo/networking/virtual-service-all-v1.yaml Now if we go back to our application and hit refresh, it will stop cycling through the multiple versions of the reviews service and will only route to the v1 version.\n Routing to only v1 versions of servicesNotice how the look of the reviews section changed here. It will remain the same even if you refresh the page\n  To summarize, we configure a rule in Istio, and Istio implements it using its sidecar containers with Apache APISIX. Neat!\nAmesh Beyond Amesh is an experimental project, and it is still in its infancy.\nFuture versions of the project aim to support more features through virtual services.\nYou can contribute to improving the project or keep track of new versions on GitHub.\n","wordCount":"1274","inLanguage":"en","image":"https://navendu.me/images/amesh/sidecar-banner.jpeg","datePublished":"2023-06-16T09:24:01+05:30","dateModified":"2023-06-16T13:59:59+05:30","author":{"@type":"Person","name":"Navendu Pottekkat"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://navendu.me/posts/amesh/"},"publisher":{"@type":"Person","name":"Navendu Pottekkat","logo":{"@type":"ImageObject","url":"https://navendu.me/favicon.ico"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href=https://navendu.me/ accesskey=h title="Navendu Pottekkat (Alt + H)">Navendu Pottekkat</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://navendu.me/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://navendu.me/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://navendu.me/dailies/ title="Daily Logs"><span>Daily Logs</span></a></li><li><a href=https://navendu.me/about/ title=About><span>About</span></a></li><li><a href=https://navendu.me/subscribe/ title=Subscribe><span>Subscribe</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://navendu.me/>Home</a>&nbsp;»&nbsp;<a href=https://navendu.me/posts/>Posts</a></div><h1 class=post-title>APISIX Service Mesh</h1><div class=post-meta><span title="2023-06-16 09:24:01 +0530 +0530">June 16, 2023</span>&nbsp;·&nbsp;6 min&nbsp;|&nbsp;<a href=https://github.com/pottekkat/personal-website/blob/hugo/content/posts/amesh.md rel="noopener noreferrer" target=_blank>Suggest Changes</a>
&nbsp;|&nbsp;<span>Originally published at&nbsp;<a href=https://api7.ai/blog/apisix-service-mesh/ title=https://api7.ai/blog/apisix-service-mesh/ target=_blank rel="noopener noreferrer">api7.ai</a></span></div></header><figure class=entry-cover><img loading=lazy src=https://navendu.me/images/amesh/sidecar-banner.jpeg alt="A motorcycle with a sidecar on a road."><p>Photo by <a href=https://www.pexels.com/photo/a-motorcycle-with-a-sidecar-on-a-road-12009262/>Zszen John</a></p></figure><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share APISIX Service Mesh on twitter" href="https://twitter.com/intent/tweet/?text=APISIX%20Service%20Mesh&url=https%3a%2f%2fnavendu.me%2fposts%2famesh%2f&hashtags=amesh%2capacheapisix%2cservice-mesh%2cistio"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share APISIX Service Mesh on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fnavendu.me%2fposts%2famesh%2f&title=APISIX%20Service%20Mesh&summary=APISIX%20Service%20Mesh&source=https%3a%2f%2fnavendu.me%2fposts%2famesh%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share APISIX Service Mesh on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fnavendu.me%2fposts%2famesh%2f&title=APISIX%20Service%20Mesh"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share APISIX Service Mesh on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fnavendu.me%2fposts%2famesh%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share APISIX Service Mesh on whatsapp" href="https://api.whatsapp.com/send?text=APISIX%20Service%20Mesh%20-%20https%3a%2f%2fnavendu.me%2fposts%2famesh%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share APISIX Service Mesh on telegram" href="https://telegram.me/share/url?text=APISIX%20Service%20Mesh&url=https%3a%2f%2fnavendu.me%2fposts%2famesh%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div><div class=post-content><p><a href="https://apisix.apache.org/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=apisix-service-mesh" target=_blank>Apache APISIX</a> is primarily used to handle north-south traffic and often sits at the boundary between client applications and backend services.</p><p>With the <a href="https://apisix.apache.org/docs/ingress-controller/next/getting-started/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=apisix-service-mesh" target=_blank>APISIX Ingress controller</a>, APISIX can also control the ingress-egress traffic in Kubernetes clusters with native configuration.</p><p>But as organizations embrace microservices, there is a new challenge to handle the east-west traffic between these microservices.</p><p>Service meshes like <a href="https://istio.io/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=apisix-service-mesh" target=_blank>Istio</a> solve this by removing the networking responsibility from the microservice developer, providing an additional L4/L7 networking layer.</p><p>With the new <a href="https://github.com/api7/Amesh?utm_source=navendu_blog&utm_medium=referral&utm_campaign=apisix-service-mesh" target=_blank>Amesh</a> library and Istio, Apache APISIX can also be used as a service mesh, specifically as a data plane for Istio, bringing all its traffic management capabilities to service-to-service communication.</p><p>In this article, we will examine what Amesh is, how it was developed, and how it is used to bring APISIX into a service mesh.</p><h2 id=istio-and-the-xds-protocol>Istio and the xDS Protocol<a hidden class=anchor aria-hidden=true href=#istio-and-the-xds-protocol>#</a></h2><p><a href="https://istio.io/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=apisix-service-mesh" target=_blank>Istio</a> is one of the most widely used service meshes.</p><p>Under the hood, Istio uses <a href="https://www.envoyproxy.io/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=apisix-service-mesh" target=_blank>Envoy</a> as the reverse proxy in its sidecar containers.</p><figure class=align-center><a href=/images/amesh/istio.png target=_blank><img loading=lazy src=/images/amesh/istio.png#center alt="Istio service mesh"></a><figcaption>Istio service mesh<p>Istio uses Envoy proxy as the data plane</p></figcaption></figure><p>Istio manages traffic by dynamically configuring the sidecars using <a href="https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/operations/dynamic_configuration?utm_source=navendu_blog&utm_medium=referral&utm_campaign=apisix-service-mesh" target=_blank>Envoy's xDS APIs</a>.</p><p>The xDS APIs are a way to configure Envoy with incremental changes instead of simple configurations with static files.</p><p>Although these APIs were initially intended for configuring Envoy, the APIs have evolved to become a <a href="https://blog.envoyproxy.io/the-universal-data-plane-api-d15cec7a?utm_source=navendu_blog&utm_medium=referral&utm_campaign=apisix-service-mesh" target=_blank>universal data plane API</a>. Any data plane proxy can implement these APIs, and any control plane can use this API to work with these data plane proxies.</p><p>In Istio, this means that you can replace the default Envoy data plane with any data plane that implements the xDS APIs. So you can replace Envoy with APISIX to get its traffic management capabilities in a service mesh.</p><p>But APISIX does not support the xDS APIs out-of-the-box. And that&rsquo;s where Amesh comes in.</p><h2 id=amesh>Amesh<a hidden class=anchor aria-hidden=true href=#amesh>#</a></h2><p><a href="https://github.com/api7/Amesh?utm_source=navendu_blog&utm_medium=referral&utm_campaign=apisix-service-mesh" target=_blank>Amesh</a> is a library that translates the data from Istio&rsquo;s control plane to APISIX configuration.</p><figure class=align-center><a href=/images/amesh/amesh.png target=_blank><img loading=lazy src=/images/amesh/amesh.png#center alt="APISIX + Amesh + Istio"></a><figcaption>APISIX + Amesh + Istio<p>APISIX replaces Envoy as the data plane for Istio</p></figcaption></figure><p>Istio communicates to the data plane through the xDS APIs. Amesh supports these APIs and then converts them to APISIX configuration.</p><p>This is similar to <a href=/posts/hands-on-set-up-ingress-on-kubernetes-with-apache-apisix-ingress-controller/>how APISIX and the APISIX Ingress controller work</a>. The Ingress controller converts the configurations defined using the Ingress or the Gateway API to APISIX format.</p><figure class=align-center><a href=/images/amesh/apisix-ingress-controller.png target=_blank><img loading=lazy src=/images/amesh/apisix-ingress-controller.png#center alt="APISIX + APISIX Ingress controller"></a><figcaption>APISIX + APISIX Ingress controller<p>The Ingress controller translates configuration defined using the Kubernetes Ingress or Gateway APIs to APISIX configuration</p></figcaption></figure><p>Since the xDS APIs are supported by more service meshes like <a href="https://linkerd.io/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=apisix-service-mesh" target=_blank>Linkerd</a> and <a href="https://openservicemesh.io/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=apisix-service-mesh" target=_blank>Open Service Mesh</a>, APISIX can also work with them using the Amesh library. Amesh is still in the early stages of development and currently works with Istio v1.13.1.</p><p>With Amesh + APISIX, you can use Istio as you would typically. Once you configure traffic rules with Istio&rsquo;s <a href="https://istio.io/latest/docs/reference/config/networking/virtual-service/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=apisix-service-mesh" target=_blank>virtual service</a>, APISIX can implement these rules.</p><p>APISIX&rsquo;s extended capabilities come through its <a href="https://apisix.apache.org/plugins/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=apisix-service-mesh" target=_blank>80+ plugins</a>. To use APISIX plugins with Istio, we deploy an Amesh control plane component called the Amesh controller.</p><p>The Amesh controller takes a plugin configuration defined with the <code>AmeshPluginConfig</code> CRD and converts it to an APISIX plugin configuration.</p><p>All of this will enable us to leverage the full capabilities of APISIX within sidecar containers.</p><h2 id=apisix--istio-mesh>APISIX + Istio Mesh<a hidden class=anchor aria-hidden=true href=#apisix--istio-mesh>#</a></h2><p>Let&rsquo;s put everything we learned about in action.</p><p>We will build the Amesh images, configure Istio to use APISIX sidecars, deploy Istio, and test everything by running a sample application.</p><h3 id=building-the-images>Building the Images<a hidden class=anchor aria-hidden=true href=#building-the-images>#</a></h3><p>We will build three images:</p><ul><li><strong>amesh-iptables</strong>: used for creating an init container to set up some iptables rules. These rules are to direct all traffic through APISIX.</li><li><strong>amesh-sidecar</strong>: used for creating the sidecar container.</li><li><strong>amesh-controller</strong>: used for creating the Amesh controller control plane component. This controller is used to configure APISIX plugins.</li></ul><p>First, clone the <a href="https://github.com/api7/Amesh?utm_source=navendu_blog&utm_medium=referral&utm_campaign=apisix-service-mesh" target=_blank>Amesh repo</a>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/api7/Amesh.git
cd Amesh
</code></pre></div><p>You can build and push these images to your own registry.</p><p>Add the address of your registry in an environment variable before you run the build, as shown below:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>export REGISTRY<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;docker.io/navendu&#34;</span>
make prepare-images
</code></pre></div><p>If you don&rsquo;t want to build your own images, you can use these images:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>docker pull navendup/amesh-iptables:dev
docker pull navendup/amesh-sidecar:dev
docker pull navendup/amesh-controller:latest
</code></pre></div><h3 id=deploy-amesh-controller-and-install-crds>Deploy Amesh Controller and Install CRDs<a hidden class=anchor aria-hidden=true href=#deploy-amesh-controller-and-install-crds>#</a></h3><p>We will use Helm to deploy everything to the Kubernetes cluster. I use minikube in these examples.</p><p>We will start by creating a new namespace <code>istio-system</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl create namespace istio-system
</code></pre></div><p>To deploy the Amesh controller, run:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>helm install amesh-controller -n istio-system <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>./controller/charts/amesh-controller
</code></pre></div><p>You also need to install CRDs to work with the Amesh controller:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl apply -k controller/config/crd/
</code></pre></div><h3 id=configure-and-deploy-istio--apisix>Configure and Deploy Istio + APISIX<a hidden class=anchor aria-hidden=true href=#configure-and-deploy-istio--apisix>#</a></h3><p>Before deploying the service mesh, we will set some environment variables:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>export ISTIO_RELEASE<span style=color:#f92672>=</span>1.13.1
export REGISTRY<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;docker.io/navendup&#34;</span>
</code></pre></div><p>Then we will use Helm to deploy the service mesh:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>helm install amesh <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>--namespace istio-system <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>--set pilot.image<span style=color:#f92672>=</span>istio/pilot:<span style=color:#e6db74>&#34;</span>$ISTIO_RELEASE<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>--set global.proxy.privileged<span style=color:#f92672>=</span>true <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>--set global.proxy_init.image<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$REGISTRY<span style=color:#e6db74>&#34;</span>/amesh-iptables:dev <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>--set global.proxy.image<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$REGISTRY<span style=color:#e6db74>&#34;</span>/amesh-sidecar:dev <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>--set global.imagePullPolicy<span style=color:#f92672>=</span>IfNotPresent <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>--set global.hub<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;docker.io/istio&#34;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>--set global.tag<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$ISTIO_RELEASE<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>./charts/amesh
</code></pre></div><p>Now we have the service mesh and Amesh controller deployed. Next, let&rsquo;s deploy a sample application to test our service mesh.</p><h3 id=deploying-bookinfo>Deploying Bookinfo<a hidden class=anchor aria-hidden=true href=#deploying-bookinfo>#</a></h3><p>We will use Istio&rsquo;s <a href="https://istio.io/latest/docs/examples/bookinfo/?utm_source=navendu_blog&utm_medium=referral&utm_campaign=apisix-service-mesh" target=_blank>Bookinfo</a> sample app.</p><p>First, we will add a label to the default namespace to automatically inject sidecars to any pod in the namespace:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl label ns default istio-injection<span style=color:#f92672>=</span>enabled
</code></pre></div><p>Then we can deploy Bookinfo by running:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl apply -f e2e/bookinfo/bookinfo.yaml
</code></pre></div><p>This will spin up the Bookinfo application, and each of the pods will have APISIX sidecars:</p><div class=highlight title=output><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ kubectl get pods

NAME                              READY   STATUS    RESTARTS   AGE
details-v1-79f774bdb9-cbn87       2/2     Running   0          55s
productpage-v1-6b746f74dc-tntc8   2/2     Running   0          55s
ratings-v1-b6994bb9-r5j45         2/2     Running   0          55s
reviews-v1-545db77b95-n657s       2/2     Running   0          55s
reviews-v2-7bf8c9648f-zn97s       2/2     Running   0          55s
reviews-v3-84779c7bbc-wn8k2       2/2     Running   0          55s
</code></pre></div><h3 id=testing-the-mesh>Testing the Mesh<a hidden class=anchor aria-hidden=true href=#testing-the-mesh>#</a></h3><p>To access the Bookinfo application, we would need an ingress gateway.</p><p>You can use APISIX for this ingress gateway, but that&rsquo;s for another time. For now, we can just use <code>port-forward</code> to access the <code>product-page</code> service:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl port-forward productpage-v1-6b746f74dc-tntc8 9080:9080
</code></pre></div><p>Now if we open up localhost:9080, we will be able to see our sample application.</p><p><figure class=align-center><a href=/images/amesh/bookinfo.png target=_blank><img loading=lazy src=/images/amesh/bookinfo.png#center alt="Bookinfo homepage"></a><figcaption>Bookinfo homepage<p>This uses the <code>reviews-v3</code> service. If you refresh the page, it will cycle through the <code>reviews</code> service</p></figcaption></figure>Each time you refresh the page, the reviews are pulled from a different version of the reviews service (we deployed three versions).</p><p>Now let&rsquo;s apply a rule using virtual services that routes all traffic to v1 versions of the services.</p><p>The rule is self-explanatory, and it would look like this:</p><div class=highlight title=virtual-service-all-v1.yaml><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>networking.istio.io/v1alpha3</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>VirtualService</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>productpage</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>hosts</span>:
  - <span style=color:#ae81ff>productpage</span>
  <span style=color:#f92672>http</span>:
  - <span style=color:#f92672>route</span>:
    - <span style=color:#f92672>destination</span>:
        <span style=color:#f92672>host</span>: <span style=color:#ae81ff>productpage</span>
        <span style=color:#f92672>subset</span>: <span style=color:#ae81ff>v1</span>
---
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>networking.istio.io/v1alpha3</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>VirtualService</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>reviews</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>hosts</span>:
  - <span style=color:#ae81ff>reviews</span>
  <span style=color:#f92672>http</span>:
  - <span style=color:#f92672>route</span>:
    - <span style=color:#f92672>destination</span>:
        <span style=color:#f92672>host</span>: <span style=color:#ae81ff>reviews</span>
        <span style=color:#f92672>subset</span>: <span style=color:#ae81ff>v1</span>
---
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>networking.istio.io/v1alpha3</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>VirtualService</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ratings</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>hosts</span>:
  - <span style=color:#ae81ff>ratings</span>
  <span style=color:#f92672>http</span>:
  - <span style=color:#f92672>route</span>:
    - <span style=color:#f92672>destination</span>:
        <span style=color:#f92672>host</span>: <span style=color:#ae81ff>ratings</span>
        <span style=color:#f92672>subset</span>: <span style=color:#ae81ff>v1</span>
---
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>networking.istio.io/v1alpha3</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>VirtualService</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>details</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>hosts</span>:
  - <span style=color:#ae81ff>details</span>
  <span style=color:#f92672>http</span>:
  - <span style=color:#f92672>route</span>:
    - <span style=color:#f92672>destination</span>:
        <span style=color:#f92672>host</span>: <span style=color:#ae81ff>details</span>
        <span style=color:#f92672>subset</span>: <span style=color:#ae81ff>v1</span>
---
</code></pre></div><p>You can apply it to your cluster by running:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.18/samples/bookinfo/networking/virtual-service-all-v1.yaml
</code></pre></div><p>Now if we go back to our application and hit refresh, it will stop cycling through the multiple versions of the reviews service and will only route to the v1 version.</p><figure class=align-center><a href=/images/amesh/bookinfo-v1.png target=_blank><img loading=lazy src=/images/amesh/bookinfo-v1.png#center alt="Routing to only v1 versions of services"></a><figcaption>Routing to only v1 versions of services<p>Notice how the look of the reviews section changed here. It will remain the same even if you refresh the page</p></figcaption></figure><p>To summarize, we configure a rule in Istio, and Istio implements it using its sidecar containers with Apache APISIX. Neat!</p><h2 id=amesh-beyond>Amesh Beyond<a hidden class=anchor aria-hidden=true href=#amesh-beyond>#</a></h2><p>Amesh is an experimental project, and it is still in its infancy.</p><p>Future versions of the project aim to support more features through virtual services.</p><p>You can contribute to improving the project or keep track of new versions on <a href="https://github.com/api7/Amesh?utm_source=navendu_blog&utm_medium=referral&utm_campaign=apisix-service-mesh" target=_blank>GitHub</a>.</p><section class=subscribe-content><hr><p>Thank you for reading <i>"APISIX Service Mesh."</i></p><p>Subscribe via <a href=/subscribe>email</a> or
<a href=/index.xml target=_blank>RSS feed</a> to be the first to receive
my content.</p><p>If you liked this post, check out my <a href=/categories/featured>featured posts</a> or learn more <a href=/about>about me</a>.</p></section><section class=subscription-form><form action="https://navendu.us5.list-manage.com/subscribe/post-json?u=fb9ffeb3ee6bc8aaf1d5b8a98&id=5ff8367bc1&c=?" method=post autocomplete=off class=subscribe-form><div class=subscribe-input><input type=email name=EMAIL id=email required placeholder="Email Address ↵" title="Email Address"></div><input value=Subscribe type=submit class=subscribe-button title=Subscribe></form><section class=entry-content><div class=subscribe-message>Get a biweekly dose of tech news, curated content, and uninterrupted musings.</div></section></section><script>$(".subscribe-form").submit(function(d){var a,b,c;d.preventDefault(),a=$(this),b=a.attr("action"),c=a.attr("method"),$.ajax({type:c,url:b,data:a.serialize(),dataType:`jsonp`,success:function(b){b.result===`success`?(a.find(".subscribe-button").attr("value","Subscribed!"),$(".subscribe-message").html("Thank you for subscribing! Check your inbox and add me in your contacts to not miss an issue! <a target='_blank' href='https://twitter.com/intent/tweet?url=https%3A%2F%2Fnavendu.me&text=I%20just%20subscribed%20to%20@sudo_navendu%27s%20blog%21%20Check%20it%20out%21&hashtags=OpenSource%2CDevelopers%2CDEVCommunity'>Tweet about it</a>!"),$(".subscribe-form :input").prop("disabled",!0)):(a.find(".subscribe-button").attr("value","Failed to Subscribe! Click again to retry"),$(".subscribe-message").html("There was an error subscribing you to my blog. "+b.msg+"."),a[0].reset()),console.log(b)},error:function(b){console.log("An error occurred."),console.log(b),a[0].reset()}})})</script></div><footer class=post-footer><ul class=post-tags><li><a href=https://navendu.me/tags/amesh/>amesh</a></li><li><a href=https://navendu.me/tags/apache-apisix/>apache apisix</a></li><li><a href=https://navendu.me/tags/service-mesh/>service-mesh</a></li><li><a href=https://navendu.me/tags/istio/>istio</a></li></ul><nav class=paginav><a class=prev href=https://navendu.me/posts/government-and-ai/><span class=title>« Prev</span><br><span>Eight Things the Indian Government Can Do about AI</span></a>
<a class=next href=https://navendu.me/posts/apisix-go-brr/><span class=title>Next »</span><br><span>How is Apache APISIX Fast?</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share APISIX Service Mesh on twitter" href="https://twitter.com/intent/tweet/?text=APISIX%20Service%20Mesh&url=https%3a%2f%2fnavendu.me%2fposts%2famesh%2f&hashtags=amesh%2capacheapisix%2cservice-mesh%2cistio"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share APISIX Service Mesh on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fnavendu.me%2fposts%2famesh%2f&title=APISIX%20Service%20Mesh&summary=APISIX%20Service%20Mesh&source=https%3a%2f%2fnavendu.me%2fposts%2famesh%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share APISIX Service Mesh on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fnavendu.me%2fposts%2famesh%2f&title=APISIX%20Service%20Mesh"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share APISIX Service Mesh on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fnavendu.me%2fposts%2famesh%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share APISIX Service Mesh on whatsapp" href="https://api.whatsapp.com/send?text=APISIX%20Service%20Mesh%20-%20https%3a%2f%2fnavendu.me%2fposts%2famesh%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share APISIX Service Mesh on telegram" href="https://telegram.me/share/url?text=APISIX%20Service%20Mesh&url=https%3a%2f%2fnavendu.me%2fposts%2famesh%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>This work by <a href=https://navendu.me/about/#about-me>Navendu Pottekkat</a></span>
<span>is licensed under <a rel=license href=http://creativecommons.org/licenses/by-sa/4.0 target=_blank>CC BY-SA 4.0</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerHTML='copy';function d(){a.innerHTML='copied!',setTimeout(()=>{a.innerHTML='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script><script>for(var els=document.getElementsByClassName("highlight"),i=0,title,code,newNode;i<els.length;i++)title=els[i].title,code=els[i].firstElementChild.firstElementChild,title.length&&(newNode=document.createElement("div"),newNode.textContent=title,newNode.classList.add("highlight-title"),code.parentNode.insertBefore(newNode,code))</script></body></html>